
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Dashboard STS</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<!-- Plugin Datalabels -->
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/><script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{--bg-dark:#0b0c10;--bg-card:#1f2833;--text-main:#c5c6c7;--text-highlight:#66fcf1;--accent-blue:#45a29e;--accent-red:#e94560;--accent-orange:#ff9f43;--success:#2ecc71;--border:#2d3e50;}
*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Outfit',sans-serif;background-color:var(--bg-dark);color:var(--text-main);padding:1rem}
.container{max-width:1600px;margin:0 auto;padding:0 1.5rem}
header{padding:2rem 0;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border);margin-bottom:2rem;flex-wrap:wrap;gap:10px}
.logo-area h1{font-size:2rem;font-weight:700;color:#fff}.logo-area span{color:var(--text-highlight)}.controls{display:flex;gap:1rem}
.btn-filter{background:rgba(69,162,158,0.1);border:1px solid var(--accent-blue);color:var(--accent-blue);padding:0.5rem 1.5rem;border-radius:8px;cursor:pointer;transition:all 0.3s}
.btn-filter.active{background:var(--text-highlight);color:var(--bg-dark);border-color:var(--text-highlight);font-weight:700}
.kpi-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:1.5rem;margin-bottom:2rem}
.kpi-card{background:var(--bg-card);padding:1.5rem;border-radius:12px;border-top:4px solid var(--border);position:relative}
.kpi-card.blue{border-color:var(--text-highlight)}.kpi-card.red{border-color:var(--accent-red)}.kpi-card.green{border-color:var(--success)}.kpi-card.orange{border-color:var(--accent-orange)}
.kpi-title{font-size:0.8rem;text-transform:uppercase;color:var(--accent-blue);margin-bottom:0.5rem}.kpi-value{font-family:'JetBrains Mono';font-size:1.8rem;font-weight:700;color:#fff}.kpi-sub{font-size:0.8rem;margin-top:0.5rem;opacity:0.7}
.tabs{display:flex;gap:10px;margin-bottom:20px;border-bottom:1px solid var(--border)}.tab{background:transparent;border:none;color:var(--text-main);opacity:0.6;padding:10px 20px;cursor:pointer;font-family:'Outfit';font-weight:500;border-bottom:2px solid transparent}.tab.active{opacity:1;color:var(--text-highlight);border-bottom:2px solid var(--text-highlight)}
.tab-content{display:none;animation:fadeIn 0.3s ease-out}.tab-content.active{display:block}@keyframes fadeIn{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}
.main-grid{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;margin-bottom:2rem}.full-grid{display:grid;grid-template-columns:1fr;gap:1.5rem;margin-bottom:2rem}
.chart-card{background:var(--bg-card);border-radius:12px;padding:1.5rem;min-height:400px;display:flex;flex-direction:column}
.chart-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.chart-title{font-size:1.1rem;font-weight:600;color:#fff}
#map{width:100%;height:400px;border-radius:8px;z-index:1;background:#111}
.data-table{width:100%;border-collapse:collapse;font-size:0.9rem}.data-table th{text-align:left;padding:1rem;color:var(--accent-blue);border-bottom:1px solid var(--border);position:sticky;top:0;background:var(--bg-card)}
.data-table td{padding:0.8rem 1rem;border-bottom:1px solid rgba(255,255,255,0.05)}.data-table tr{cursor:pointer;transition:background 0.2s}.data-table tr:hover{background:rgba(255,255,255,0.05)}.data-table tr.selected{background:rgba(102,252,241,0.1);border-left:3px solid var(--text-highlight)}
.amount-cell{font-family:'JetBrains Mono';text-align:right}.text-right{text-align:right}
.rec-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1.5rem;margin-top:2rem}
.rec-card{background:rgba(31,40,51,0.5);border:1px solid var(--border);border-radius:12px;padding:1.5rem}
.rec-card.budget{border-left:4px solid var(--success)}.rec-card.alert{border-left:4px solid var(--accent-red)}.rec-card.info{border-left:4px solid var(--text-highlight)}
.rec-title{font-size:1.1rem;font-weight:700;color:var(--text-highlight);margin-bottom:0.5rem}.budget-list{margin-top:10px;border-top:1px solid rgba(255,255,255,0.1);padding-top:10px}
.budget-item{display:flex;justify-content:space-between;font-size:0.9rem;margin-bottom:5px}.budget-val{font-family:'JetBrains Mono';font-weight:700;color:#fff}.budget-current{color:var(--accent-orange);font-weight:700}
.budget-section-title{font-size:0.8rem; text-transform:uppercase; color:var(--accent-blue); margin-top:10px; margin-bottom:5px; font-weight:700;}
.comparison-cards{display:grid;grid-template-columns:repeat(2,1fr);gap:2rem;margin-bottom:2rem}.year-card{background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:1.5rem;text-align:center;border-top:4px solid var(--border)}
.year-card.highlight{border-color:var(--text-highlight);border-top:4px solid var(--text-highlight);background:rgba(102,252,241,0.05)}
.metric-value{font-size:1.5rem;font-weight:700;color:#fff;font-family:'JetBrains Mono'}.diff-badge{display:inline-block;padding:0.2rem 0.5rem;border-radius:4px;font-size:0.8rem;font-weight:700}
.diff-badge.up{background:rgba(233,69,96,0.2);color:var(--accent-red)}.diff-badge.down{background:rgba(46,204,113,0.2);color:var(--success)}
.custom-tooltip{background:rgba(11,12,16,0.9);border:1px solid var(--text-highlight);color:#fff;padding:5px 10px;border-radius:4px}
.btn-small{font-size:0.75rem;padding:4px 8px;border-radius:4px;background:var(--bg-dark);border:1px solid var(--border);color:var(--text-main);cursor:pointer}
</style>
</head>
<body>
<div class="container">
<header><div class="logo-area"><h1>STS <span>Dashboard</span></h1><div class="subtitle">An√°lisis de Comprobantes 2024-2025</div></div>
<div class="controls"><button class="btn-filter active" onclick="filterData('all',this)">Todo</button><button class="btn-filter" onclick="filterData('2024',this)">2024</button><button class="btn-filter" onclick="filterData('2025',this)">2025</button></div></header>

<div class="kpi-grid">
<div class="kpi-card blue"><div class="kpi-title">Gasto Total</div><div class="kpi-value" id="kpi-total">$0</div><div class="kpi-sub" id="kpi-total-sub">-- comp</div></div>
<div class="kpi-card red"><div class="kpi-title">No Deducible</div><div class="kpi-value" style="color:var(--accent-red)" id="kpi-noded">$0</div><div class="kpi-sub" id="kpi-noded-pct">--%</div></div>
<div class="kpi-card green"><div class="kpi-title">Deducible</div><div class="kpi-value" style="color:var(--success)" id="kpi-ded">$0</div><div class="kpi-sub">CFDI</div></div>
<div class="kpi-card orange"><div class="kpi-title">Top Estado</div><div class="kpi-value" id="kpi-top-state">--</div><div class="kpi-sub" id="kpi-top-state-val">$0</div></div>
</div>

<div class="tabs">
    <button class="tab active" onclick="showTab('general',this)">üìä An√°lisis General</button>
    <button class="tab" onclick="showTab('mapa',this)">üó∫Ô∏è Geogr√°fico</button>
    <button class="tab" onclick="showTab('comparativa',this)">üÜö Comparativa Anual</button>
    <button class="tab" onclick="showTab('usuarios',this)">üë• Usuarios</button>
    <button class="tab" onclick="showTab('audit',this)">üîç Auditor√≠a</button>
</div>

<!-- TABS -->
<div id="general" class="tab-content active">
    <div class="main-grid"><div class="chart-card"><div class="chart-header"><div class="chart-title">Evoluci√≥n Mensual</div></div><div style="height:300px"><canvas id="trendChart"></canvas></div></div>
    <div class="chart-card"><div class="chart-header"><div class="chart-title">Gastos por Tipo</div></div><div style="height:300px;display:flex;justify-content:center"><canvas id="categoryChart"></canvas></div></div></div>
</div>

<div id="mapa" class="tab-content">
    <div class="full-grid"><div class="chart-card"><div class="chart-header"><div class="chart-title">Mapa Interactivo</div></div><div id="map"></div></div></div>
    <div class="main-grid">
    <div class="chart-card"><div class="chart-header"><div class="chart-title">Estados</div></div><div style="overflow-y:auto;max-height:400px"><table class="data-table"><thead><tr><th>Estado</th><th class="text-right">Monto</th></tr></thead><tbody id="state-table-body"></tbody></table></div></div>
    <div class="chart-card"><div class="chart-header"><div class="chart-title">Categor√≠as en: <span id="selected-state-name" style="color:var(--text-highlight)">Nacional</span></div><button class="btn-small" onclick="resetGeoFilter()">Ver Nacional</button></div>
    <div style="overflow-y:auto;max-height:400px"><table class="data-table"><thead><tr><th>Categor√≠a</th><th class="text-right">Monto</th><th class="text-right">%</th></tr></thead><tbody id="state-categories-body"></tbody></table></div></div>
    </div>
</div>

<div id="comparativa" class="tab-content">
    <div id="comparison-container"></div>
    <div class="main-grid"><div class="chart-card"><div class="chart-header"><div class="chart-title">Total vs No Deducible</div></div><div style="height:300px"><canvas id="compBarChart"></canvas></div></div>
    <div class="chart-card"><div class="chart-header"><div class="chart-title">Tendencia 2024 vs 2025</div></div><div style="height:300px"><canvas id="compLineChart"></canvas></div></div></div>
</div>

<div id="usuarios" class="tab-content">
    <div class="main-grid">
        <div class="chart-card"><div class="chart-header"><div class="chart-title">Top 10 Gasto Total</div></div><div style="height:300px"><canvas id="userChart"></canvas></div></div>
        <div class="chart-card"><div class="chart-header"><div class="chart-title">Top 10 No Deducible</div></div><div style="height:300px"><canvas id="userChartNoDed"></canvas></div></div>
    </div>
    
    <!-- MASTER DETAIL: LISTA DE USUARIOS + GRAFICO DE CATEGORIAS DEL USUARIO -->
    <div class="main-grid" style="grid-template-columns: 1fr 1fr;">
        <div class="chart-card">
            <div class="chart-header"><div class="chart-title">üìã Lista Detallada (Selecciona para ver detalle)</div></div>
            <div style="margin-top:1rem;overflow-y:auto;max-height:400px">
                <table class="data-table">
                    <thead><tr><th>Usuario</th><th class="text-right">Total</th><th class="text-right">No Ded.</th><th class="text-right">% No Ded.</th></tr></thead>
                    <tbody id="user-table-body"></tbody>
                </table>
            </div>
        </div>
        <div class="chart-card">
            <div class="chart-header"><div class="chart-title">Desglose de: <span id="selected-user-name" style="color:var(--text-highlight)">--</span></div></div>
            <div style="height:350px;display:flex;justify-content:center;align-items:center;">
                <canvas id="userCategoryChart"></canvas>
            </div>
        </div>
    </div>
</div>

<div id="audit" class="tab-content">
    <div class="main-grid">
        <div class="chart-card"><div class="chart-header"><div class="chart-title">Top 5 Proveedores (Negociaci√≥n)</div></div><div style="height:300px"><canvas id="chartProviders"></canvas></div></div>
        <div class="chart-card"><div class="chart-header"><div class="chart-title">Riesgo Semanal</div></div><div style="height:300px;position:relative;width:100%"><canvas id="chartWeekend"></canvas></div></div>
    </div>
    <div class="chart-card"><div class="chart-header"><div class="chart-title">Riesgo por Medio de Pago (Etiquetas = %)</div></div><div style="height:300px"><canvas id="chartPayment"></canvas></div></div>
</div>

<div class="rec-section"><div class="rec-header">üéØ Recomendaciones & Presupuestos</div><div class="rec-grid">
<div class="rec-card budget"><span class="rec-icon">üè®</span><div class="rec-title">Hotel</div><div class="budget-list" id="rec-hotel-list"></div></div>
<div class="rec-card budget"><span class="rec-icon">üçΩÔ∏è</span><div class="rec-title">Alimentos</div><div class="budget-list" id="rec-food-list"></div></div>
<div class="rec-card alert"><span class="rec-icon">‚ö†Ô∏è</span><div class="rec-title">Foco Rojo</div><div class="rec-desc">Categor√≠a principal: <strong id="rec-cat-name" style="color:#fff">--</strong></div><div class="rec-metric" id="rec-cat-val">$0</div></div>
<div class="rec-card info"><span class="rec-icon">üìã</span><div class="rec-title">Acciones</div><div class="rec-desc">1. Negociar tarifas con Top Proveedores.<br>2. Restringir efectivo (causa alta de No Deducible).<br>3. Revisar gastos de fin de semana.</div></div>
</div></div>
</div>

<script>
const stsData = {"2024": {"total": 2014314.37, "deducible": 1843558.99, "noDeducible": 170755.38, "comprobantes": 5334, "viajes": 606, "months": {"1": {"total": 103654.19, "noDeducible": 4688.88}, "2": {"total": 108503.65, "noDeducible": 5537.91}, "3": {"total": 167272.72, "noDeducible": 14385.79}, "4": {"total": 175300.47, "noDeducible": 18951.76}, "5": {"total": 79534.02, "noDeducible": 12678.44}, "6": {"total": 124379.08, "noDeducible": 11683.13}, "7": {"total": 125930.73, "noDeducible": 11045.28}, "8": {"total": 196458.13999999998, "noDeducible": 15353.15}, "9": {"total": 176696.53, "noDeducible": 15150.52}, "10": {"total": 280678.49, "noDeducible": 22826.15}, "11": {"total": 240528.36, "noDeducible": 19181.8}, "12": {"total": 235377.99, "noDeducible": 19272.57}}, "states": {"SinCP": {"total": 194098.79999999996, "types": {"Alimentos sin comprobante": 5705.79, "Casetas": 270.0, "Comida local": 2572.0, "Consumo nacional": 3288.99, "Consumo nacional - Efectivo": 205.0, "Gasolina": 2310.6, "Hotel": 8782.32, "Otros gastos": 1350.96, "Propina": 312.6, "Sin comprobante CFDI": 153188.08, "Sin comprobante CFDI - Efectivo": 11548.91, "Taxi": 4563.55}}, "Chihuahua": {"total": 20958.34, "types": {"Autob\u00fas": 934.0, "Comida local": 976.0, "Consumo nacional": 1202.0, "Hotel": 10971.17, "Taxi": 6875.17}}, "Jalisco": {"total": 565885.6599999999, "types": {"Autob\u00fas": 33723.01, "Casetas": 16155.0, "Casetas - Efectivo": 7605.0, "Comida local": 50045.36, "Comida local - Efectivo": 179.0, "Consumo nacional": 107701.28, "Consumo nacional - Efectivo": 813.9100000000001, "Estacionamiento": 165.0, "Estacionamiento - Efectivo": 110.0, "Gasolina": 25499.63, "Hotel": 124195.91, "Otros gastos": 3261.3, "Taxi": 196131.28, "Telefono": 299.98}}, "Quer\u00e9taro": {"total": 27405.69, "types": {"Comida local": 4062.0, "Consumo nacional": 8324.49, "Estacionamiento - Efectivo": 25.0, "Gasolina": 1962.43, "Hotel": 5042.82, "Otros gastos": 169.0, "Taxi": 7819.95}}, "Ciudad de M\u00e9xico": {"total": 258021.16, "types": {"Autob\u00fas": 100473.05, "Avi\u00f3n": 1210.0, "Casetas": 2729.0, "Casetas - Efectivo": 2668.0, "Comida local": 13921.0, "Comida local - Efectivo": 416.0, "Consumo nacional": 15249.01, "Consumo nacional - Efectivo": 798.0, "Estacionamiento": 156.0, "Hotel": 34534.95, "Hotel - Efectivo": 1300.0, "Otros gastos": 2529.71, "Taxi": 79957.71, "Taxi - Efectivo": 2078.73}}, "M\u00e9xico": {"total": 133966.15000000002, "types": {"Autob\u00fas": 4508.0, "Comida local": 4655.49, "Consumo nacional": 4333.93, "Hotel": 31356.12, "Otros gastos": 2327.4, "Taxi": 84050.21, "Taxi - Efectivo": 2735.0}}, "Guanajuato": {"total": 107606.83, "types": {"Autob\u00fas": 68301.4, "Casetas": 72.0, "Comida local": 2808.9, "Consumo nacional": 12862.6, "Estacionamiento": 585.0, "Gasolina": 5864.35, "Hotel": 12559.92, "Otros gastos": 1381.7399999999998, "Taxi": 3170.92}}, "Baja California Sur": {"total": 25435.02, "types": {"Autob\u00fas": 370.0, "Comida local": 342.0, "Consumo nacional": 6271.0, "Gasolina": 1508.95, "Hotel": 12094.0, "Taxi": 4849.07}}, "Aguascalientes": {"total": 45152.30999999999, "types": {"Autob\u00fas": 37843.0, "Autob\u00fas - Efectivo": 2444.0, "Comida local": 500.25, "Consumo nacional": 1395.0, "Gasolina": 825.02, "Hotel": 1913.52, "Taxi": 231.52}}, "Veracruz de Ignacio de la Llave": {"total": 29396.420000000002, "types": {"Comida local": 3572.3, "Consumo nacional": 5231.29, "Consumo nacional - Efectivo": 425.0, "Hotel": 14585.95, "Otros gastos": 1260.73, "Taxi": 3950.56, "Taxi - Efectivo": 370.59000000000003}}, "Nayarit": {"total": 16467.19, "types": {"Autob\u00fas": 611.0, "Consumo nacional": 962.51, "Taxi": 14893.68}}, "Michoac\u00e1n de Ocampo": {"total": 26536.239999999998, "types": {"Autob\u00fas": 810.0, "Comida local": 1139.0, "Consumo nacional": 8954.99, "Gasolina": 584.58, "Hotel": 6427.05, "Taxi": 8281.26, "Taxi - Efectivo": 339.36}}, "Coahuila de Zaragoza": {"total": 18660.29, "types": {"Autob\u00fas": 707.0, "Comida local": 2942.01, "Comida local - Efectivo": 161.0, "Consumo nacional": 1670.0, "Consumo nacional - Efectivo": 754.2, "Hotel": 8814.74, "Hotel - Efectivo": 849.0, "Otros gastos": 406.46000000000004, "Taxi": 1940.8799999999999, "Taxi - Efectivo": 415.0}}, "Tlaxcala": {"total": 12507.060000000001, "types": {"Autob\u00fas": 3400.0, "Comida local": 1075.0, "Consumo nacional": 1870.28, "Hotel": 5179.99, "Taxi": 981.79}}, "Nuevo Le\u00f3n": {"total": 41728.86, "types": {"Autob\u00fas - Efectivo": 840.0, "Consumo nacional": 2507.49, "Consumo nacional - Efectivo": 87.0, "Gasolina": 7450.0, "Hotel": 4800.0, "Otros gastos": 1764.6599999999999, "Taxi": 22812.170000000002, "Taxi - Efectivo": 1467.54}}, "San Luis Potos\u00ed": {"total": 17868.149999999998, "types": {"Casetas": 228.0, "Casetas - Efectivo": 384.0, "Comida local": 558.0, "Consumo nacional": 10275.4, "Hotel": 3553.4, "Taxi": 2869.35}}, "Puebla": {"total": 10974.15, "types": {"Autob\u00fas": 2572.0, "Comida local": 3859.99, "Consumo nacional": 613.0, "Otros gastos": 270.18, "Taxi": 3514.24, "Taxi - Efectivo": 144.74}}, "Tabasco": {"total": 34873.45, "types": {"Comida local": 3127.0, "Consumo nacional": 4302.28, "Hotel": 21381.989999999998, "Otros gastos": 125.0, "Taxi": 5937.18}}, "Sonora": {"total": 33794.5, "types": {"Autob\u00fas": 864.0, "Autob\u00fas - Efectivo": 484.0, "Comida local": 1436.0, "Consumo nacional": 6887.09, "Consumo nacional - Efectivo": 1588.01, "Hotel": 14417.07, "Hotel - Efectivo": 1245.0, "Lavander\u00eda": 1760.0, "Taxi": 4585.5199999999995, "Taxi - Efectivo": 527.81}}, "Sinaloa": {"total": 11053.03, "types": {"Autob\u00fas": 551.0, "Consumo nacional": 3218.5299999999997, "Hotel": 5140.39, "Taxi": 2143.11}}, "Yucat\u00e1n": {"total": 32276.23, "types": {"Comida local": 5290.0, "Consumo nacional": 3958.73, "Hotel": 13538.0, "Otros gastos": 2113.13, "Taxi": 7376.37}}, "Quintana Roo": {"total": 154453.73, "types": {"Comida local": 6224.0, "Consumo nacional": 12842.4, "Consumo nacional - Efectivo": 70.0, "Gasolina": 12631.73, "Hotel": 61419.04, "Otros gastos": 1574.98, "Taxi": 47991.58, "Taxi - Efectivo": 11700.0}}, "Oaxaca": {"total": 25825.99, "types": {"Comida local": 2604.02, "Consumo nacional": 674.0, "Consumo nacional - Efectivo": 465.75, "Hotel": 14064.02, "Taxi": 8018.2}}, "Baja California": {"total": 47635.44, "types": {"Autob\u00fas": 4786.0, "Comida local": 1666.0, "Consumo nacional": 8411.9, "Hotel": 8975.33, "Otros gastos": 767.64, "Taxi": 23028.57}}, "Morelos": {"total": 2207.49, "types": {"Comida local": 319.0, "Consumo nacional": 327.0, "Otros gastos": 444.81, "Taxi": 1116.68}}, "Guerrero": {"total": 51270.36, "types": {"Autob\u00fas": 200.0, "Comida local": 3404.01, "Consumo nacional": 8446.83, "Consumo nacional - Efectivo": 174.5, "Hotel": 23396.0, "Otros gastos": 405.0, "Taxi": 10474.02, "Taxi - Efectivo": 4770.0}}, "Tamaulipas": {"total": 25830.77, "types": {"Autob\u00fas": 2277.0, "Comida local": 825.0, "Consumo nacional": 4431.9, "Consumo nacional - Efectivo": 443.49, "Hotel": 15803.04, "Taxi": 1953.76, "Taxi - Efectivo": 96.58}}, "Durango": {"total": 4557.27, "types": {"Consumo nacional": 660.0, "Hotel": 2650.0, "Taxi": 1247.27}}, "Hidalgo": {"total": 2695.38, "types": {"Comida local": 1314.0, "Consumo nacional": 731.0, "Taxi": 650.38}}, "Chiapas": {"total": 26064.0, "types": {"Autob\u00fas": 370.0, "Comida local": 796.0, "Consumo nacional": 4724.02, "Hotel": 13453.0, "Otros gastos": 246.98000000000002, "Taxi": 6474.0}}, "Colima": {"total": 2708.52, "types": {"Comida local": 385.0, "Consumo nacional": 1072.0, "Hotel": 1150.0, "Taxi": 101.52000000000001}}, "Campeche": {"total": 2546.64, "types": {"Consumo nacional": 428.5, "Hotel": 1486.8, "Taxi": 281.34, "Taxi - Efectivo": 350.0}}, "Zacatecas": {"total": 3853.25, "types": {"Consumo nacional": 1058.0, "Hotel": 2663.22, "Taxi": 132.03}}}, "users": {"Alfonso Caballero Chavez": {"total": 10265.17, "noDeducible": 0.0, "categories": {"Comida local": 5251.39, "Consumo nacional": 5013.78}}, "Cesar Mendoza": {"total": 271783.2, "noDeducible": 45474.26, "categories": {"Alimentos sin comprobante": 1136.0, "Autob\u00fas": 43458.5, "Casetas": 175.0, "Comida local": 22116.91, "Consumo nacional": 17023.37, "Consumo nacional - Efectivo": 486.4, "Hotel": 51016.0, "Otros gastos": 3023.89, "Sin comprobante CFDI": 42813.66, "Sin comprobante CFDI - Efectivo": 1524.6, "Taxi": 86038.87, "Taxi - Efectivo": 2970.0}}, "Diego Hern\u00e1ndez": {"total": 125276.82, "noDeducible": 38788.1, "categories": {"Alimentos sin comprobante": 1112.0, "Autob\u00fas": 14483.0, "Comida local": 10968.03, "Consumo nacional": 17220.77, "Hotel": 15193.59, "Otros gastos": 4445.22, "Sin comprobante CFDI": 37676.1, "Taxi": 24178.11}}, "Emmanuel Ramirez": {"total": 6475.23, "noDeducible": 444.6, "categories": {"Comida local": 774.0, "Consumo nacional": 1123.0, "Gasolina": 825.02, "Hotel": 1775.0, "Sin comprobante CFDI": 444.6, "Taxi": 1533.61}}, "Gustavo Gomez": {"total": 329917.86, "noDeducible": 6499.89, "categories": {"Alimentos sin comprobante": 38.97, "Autob\u00fas": 18344.0, "Casetas": 8484.0, "Casetas - Efectivo": 2486.0, "Comida local": 6346.5, "Comida local - Efectivo": 177.0, "Consumo nacional": 32579.53, "Consumo nacional - Efectivo": 410.51, "Gasolina": 13768.95, "Hotel": 107512.19, "Sin comprobante CFDI": 6079.68, "Sin comprobante CFDI - Efectivo": 381.24, "Taxi": 132309.29, "Taxi - Efectivo": 1000.0}}, "Jesus Gerado Castellanos Martinez": {"total": 32996.58, "noDeducible": 733.06, "categories": {"Autob\u00fas": 2610.0, "Casetas": 380.0, "Casetas - Efectivo": 1592.0, "Comida local": 937.0, "Consumo nacional": 4326.63, "Estacionamiento": 165.0, "Estacionamiento - Efectivo": 110.0, "Gasolina": 1668.69, "Hotel": 7260.42, "Sin comprobante CFDI": 573.26, "Sin comprobante CFDI - Efectivo": 159.8, "Taxi": 13213.779999999999}}, "Jes\u00fas David Cruz Uribe": {"total": 22949.24, "noDeducible": 6524.82, "categories": {"Autob\u00fas": 376.0, "Consumo nacional": 11640.37, "Hotel": 2189.6, "Sin comprobante CFDI": 3987.42, "Sin comprobante CFDI - Efectivo": 2537.4, "Taxi": 2218.45}}, "Jorge Bustamante Alonso": {"total": 39498.31, "noDeducible": 17.0, "categories": {"Autob\u00fas": 2117.0, "Comida local": 8942.39, "Consumo nacional": 10905.39, "Hotel": 13473.58, "Sin comprobante CFDI": 17.0, "Taxi": 4042.95}}, "Jos\u00e9 Eduardo Monta\u00f1o Cervantes": {"total": 158772.56, "noDeducible": 8147.15, "categories": {"Alimentos sin comprobante": 1479.0, "Autob\u00fas": 50604.0, "Comida local": 9389.78, "Consumo nacional": 29971.47, "Consumo nacional - Efectivo": 451.99, "Gasolina": 1508.95, "Hotel": 28820.4, "Hotel - Efectivo": 1300.0, "Otros gastos": 2208.3999999999996, "Sin comprobante CFDI": 6473.85, "Sin comprobante CFDI - Efectivo": 194.3, "Taxi": 25578.57, "Taxi - Efectivo": 791.85}}, "Jos\u00e9 de Jesus Coronado": {"total": 226091.02, "noDeducible": 12388.44, "categories": {"Alimentos sin comprobante": 357.0, "Autob\u00fas": 17327.5, "Casetas": 4803.0, "Casetas - Efectivo": 5245.0, "Comida local": 10470.45, "Comida local - Efectivo": 239.0, "Consumo nacional": 25234.99, "Consumo nacional - Efectivo": 784.75, "Estacionamiento - Efectivo": 25.0, "Gasolina": 11566.630000000001, "Hotel": 48488.11, "Otros gastos": 381.0, "Propina": 43.1, "Sin comprobante CFDI": 11833.02, "Sin comprobante CFDI - Efectivo": 155.32, "Taxi": 88837.17, "Telefono": 299.98}}, "Juan Andr\u00e9s Pineda": {"total": 101603.05, "noDeducible": 3879.2799999999997, "categories": {"Autob\u00fas": 2704.0, "Comida local": 3467.4, "Consumo nacional": 26827.52, "Consumo nacional - Efectivo": 470.01, "Hotel": 38863.96, "Otros gastos": 767.64, "Sin comprobante CFDI": 3670.48, "Sin comprobante CFDI - Efectivo": 208.8, "Taxi": 24623.24}}, "Luis Enrique Garcia Solis": {"total": 152298.86, "noDeducible": 7230.36, "categories": {"Alimentos sin comprobante": 323.32, "Autob\u00fas": 16355.0, "Autob\u00fas - Efectivo": 3768.0, "Comida local": 11326.81, "Comida local - Efectivo": 161.0, "Consumo nacional": 11106.91, "Consumo nacional - Efectivo": 2887.2, "Gasolina": 9250.0, "Hotel": 41217.44, "Hotel - Efectivo": 2094.0, "Otros gastos": 2296.12, "Propina": 228.3, "Sin comprobante CFDI": 6332.22, "Sin comprobante CFDI - Efectivo": 346.52, "Taxi": 41517.52, "Taxi - Efectivo": 3088.5}}, "Omar de Jes\u00fas Jim\u00e9nez Medrano": {"total": 31010.34, "noDeducible": 2972.04, "categories": {"Autob\u00fas": 9123.95, "Casetas": 781.0, "Comida local": 2665.89, "Consumo nacional": 1714.02, "Gasolina": 2552.95, "Hotel": 1550.0, "Otros gastos": 2788.0, "Sin comprobante CFDI": 2972.04, "Taxi": 6862.49}}, "Ramon Fregoso": {"total": 308639.88, "noDeducible": 6330.7, "categories": {"Autob\u00fas": 56596.51, "Avi\u00f3n": 1210.0, "Casetas": 4831.0, "Casetas - Efectivo": 1334.0, "Comida local": 15737.09, "Comida local - Efectivo": 179.0, "Consumo nacional": 40258.73, "Consumo nacional - Efectivo": 59.0, "Estacionamiento": 741.0, "Gasolina": 5780.33, "Hotel": 103787.26, "Lavander\u00eda": 1760.0, "Otros gastos": 632.3, "Sin comprobante CFDI": 5677.94, "Sin comprobante CFDI - Efectivo": 652.76, "Taxi": 69402.96}}, "Roberto Reyna": {"total": 4750.0, "noDeducible": 4750.0, "categories": {"Alimentos sin comprobante": 1000.0, "Sin comprobante CFDI": 3750.0}}, "Timoteo Rivera": {"total": 155312.37, "noDeducible": 22895.28, "categories": {"Autob\u00fas": 25266.0, "Comida local": 10787.69, "Consumo nacional": 6256.69, "Consumo nacional - Efectivo": 70.0, "Gasolina": 11715.77, "Hotel": 17347.8, "Otros gastos": 3688.1099999999997, "Propina": 41.2, "Sin comprobante CFDI": 20766.47, "Sin comprobante CFDI - Efectivo": 2087.61, "Taxi": 45585.03, "Taxi - Efectivo": 11700.0}}, "\u00c1ngel Alexis Rivera": {"total": 36673.88, "noDeducible": 3680.4, "categories": {"Alimentos sin comprobante": 259.5, "Autob\u00fas": 3935.0, "Comida local": 1238.0, "Consumo nacional": 13684.27, "Consumo nacional - Efectivo": 205.0, "Hotel": 5854.41, "Otros gastos": 169.0, "Sin comprobante CFDI": 120.33999999999999, "Sin comprobante CFDI - Efectivo": 3300.56, "Taxi": 2462.8, "Taxi - Efectivo": 5445.0}}}, "categories": {"Alimentos sin comprobante": 5705.79, "Autob\u00fas": 263300.46, "Autob\u00fas - Efectivo": 3768.0, "Avi\u00f3n": 1210.0, "Casetas": 19454.0, "Casetas - Efectivo": 10657.0, "Comida local": 120419.33, "Comida local - Efectivo": 756.0, "Consumo nacional": 254887.44, "Consumo nacional - Efectivo": 5824.86, "Estacionamiento": 906.0, "Estacionamiento - Efectivo": 135.0, "Gasolina": 58637.29, "Hotel": 484349.76, "Hotel - Efectivo": 3394.0, "Lavander\u00eda": 1760.0, "Otros gastos": 20399.68, "Propina": 312.6, "Sin comprobante CFDI": 153188.08, "Sin comprobante CFDI - Efectivo": 11548.91, "Taxi": 568404.84, "Taxi - Efectivo": 24995.35, "Telefono": 299.98}, "cost_centers": {"Tecnicos": 2009564.37, "Ventas": 4750.0}, "audit": {"providers": [{"name": "INMOBILIARIA RUIZ SOUZA", "total": 121107.70999999999, "cat": "Hotel, Consumo nacional"}, {"name": "JOSE FRANCISCO RAMIREZ HERRERA", "total": 103416.39, "cat": "Taxi"}, {"name": "AUTOBUSES DE LA PIEDAD", "total": 68218.4, "cat": "Autob\u00fas"}, {"name": "DIGITAL SOLUTIONS AMERICAS", "total": 50434.78, "cat": "Taxi, Taxi - Efectivo"}, {"name": "RICARDO MONROY PRUDENCIO", "total": 47477.020000000004, "cat": "Taxi, Taxi - Efectivo"}], "weekend": {"weekend": 248675.37, "weekday": 1765639.0}, "payment": {"Efectivo": {"Pago Total": 317498.03, "No Deducible": 73306.01}, "Tarjeta Corporativa": {"Pago Total": 1669849.22, "No Deducible": 97432.37}, "Tarjeta Personal": {"Pago Total": 26967.12, "No Deducible": 17.0}}}}, "2025": {"total": 2445400.58, "deducible": 2221968.13, "noDeducible": 223432.44999999998, "comprobantes": 6495, "viajes": 707, "months": {"1": {"total": 193239.68, "noDeducible": 26159.02}, "2": {"total": 193541.78, "noDeducible": 17525.74}, "3": {"total": 199560.18, "noDeducible": 21439.06}, "4": {"total": 233609.52, "noDeducible": 19938.84}, "5": {"total": 248992.03, "noDeducible": 22932.1}, "6": {"total": 214840.69, "noDeducible": 16475.85}, "7": {"total": 242036.86, "noDeducible": 18099.420000000002}, "8": {"total": 204966.15, "noDeducible": 14469.31}, "9": {"total": 177646.76, "noDeducible": 14633.460000000001}, "10": {"total": 182413.46, "noDeducible": 19702.12}, "11": {"total": 171576.92, "noDeducible": 17150.0}, "12": {"total": 182976.55, "noDeducible": 14907.53}}, "states": {"Ciudad de M\u00e9xico": {"total": 393969.16000000003, "types": {"Autob\u00fas": 86557.56, "Autob\u00fas - Efectivo": 9565.5, "Avi\u00f3n": 8695.96, "Casetas": 410.0, "Casetas - Efectivo": 28247.0, "Comida local": 10998.5, "Comida local - Efectivo": 801.0, "Consumo nacional": 20280.44, "Consumo nacional - Efectivo": 7910.08, "Estacionamiento - Efectivo": 227.0, "Hotel": 37898.82, "Hotel - Efectivo": 5553.16, "Otros gastos": 5559.4, "Otros gastos - Efectivo": 906.99, "Taxi": 68153.65, "Taxi - Efectivo": 102204.1}}, "SinCP": {"total": 268873.82, "types": {"Alimentos sin comprobante": 2046.28, "Alimentos sin comprobante - Efectivo": 741.0, "Casetas - Efectivo": 285.0, "Comida local": 2348.0, "Consumo nacional": 5079.1, "Consumo nacional - Efectivo": 1521.1399999999999, "Gasolina": 1091.31, "Hotel": 10104.72, "Otros gastos": 1254.05, "Propina": 436.99, "Sin comprobante CFDI": 182333.28, "Sin comprobante CFDI - Efectivo": 37874.9, "Taxi": 16529.54, "Taxi - Efectivo": 7228.51}}, "Yucat\u00e1n": {"total": 44565.9, "types": {"Autob\u00fas": 220.01, "Comida local": 2070.01, "Comida local - Efectivo": 135.0, "Consumo nacional": 7003.91, "Consumo nacional - Efectivo": 198.0, "Hotel": 15915.95, "Taxi": 9088.16, "Taxi - Efectivo": 9934.86}}, "Jalisco": {"total": 474714.66000000003, "types": {"Autob\u00fas": 20475.0, "Autob\u00fas - Efectivo": 1836.0, "Casetas": 1171.0, "Casetas - Efectivo": 48323.0, "Comida local": 10026.26, "Comida local - Efectivo": 903.2, "Consumo nacional": 47696.64, "Consumo nacional - Efectivo": 30334.18, "Estacionamiento": 165.0, "Estacionamiento - Efectivo": 655.01, "Gasolina": 61253.54, "Hotel": 65284.97, "Hotel - Efectivo": 3312.0, "Otros gastos": 1122.26, "Taxi": 175369.79, "Taxi - Efectivo": 6786.8099999999995}}, "Veracruz de Ignacio de la Llave": {"total": 63834.85999999999, "types": {"Comida local": 1164.5, "Comida local - Efectivo": 38.0, "Consumo nacional": 9374.64, "Consumo nacional - Efectivo": 1341.99, "Hotel": 32062.29, "Otros gastos": 994.95, "Otros gastos - Efectivo": 168.39, "Taxi": 6143.99, "Taxi - Efectivo": 12546.11}}, "Quintana Roo": {"total": 140278.06, "types": {"Comida local": 9538.99, "Comida local - Efectivo": 281.5, "Consumo nacional": 16061.48, "Consumo nacional - Efectivo": 1888.22, "Hotel": 42102.86, "Hotel - Efectivo": 2249.9700000000003, "Otros gastos": 188.51, "Taxi": 19004.49, "Taxi - Efectivo": 48962.04}}, "Oaxaca": {"total": 17447.54, "types": {"Comida local": 460.0, "Comida local - Efectivo": 400.0, "Consumo nacional": 2093.0, "Consumo nacional - Efectivo": 752.0, "Hotel": 6692.3, "Otros gastos": 535.24, "Otros gastos - Efectivo": 1780.0, "Taxi": 2830.0, "Taxi - Efectivo": 1905.0}}, "M\u00e9xico": {"total": 136561.11, "types": {"Autob\u00fas": 9894.0, "Autob\u00fas - Efectivo": 930.0, "Comida local": 2726.0, "Consumo nacional": 11270.24, "Consumo nacional - Efectivo": 933.8, "Hotel": 35670.8, "Otros gastos": 1105.73, "Taxi": 29278.74, "Taxi - Efectivo": 44751.8}}, "Aguascalientes": {"total": 47427.53, "types": {"Autob\u00fas": 21158.0, "Autob\u00fas - Efectivo": 140.0, "Comida local": 1051.0, "Consumo nacional": 5663.8, "Gasolina": 4602.43, "Hotel": 14498.92, "Taxi": 191.13, "Taxi - Efectivo": 122.25}}, "Baja California": {"total": 56858.5, "types": {"Autob\u00fas": 1643.0, "Comida local": 3295.5, "Consumo nacional": 5909.0, "Consumo nacional - Efectivo": 1048.87, "Hotel": 2240.01, "Otros gastos": 896.0, "Taxi": 41126.12, "Taxi - Efectivo": 700.0}}, "Sinaloa": {"total": 25727.52, "types": {"Autob\u00fas - Efectivo": 80.0, "Consumo nacional": 7048.19, "Consumo nacional - Efectivo": 307.52, "Hotel": 15286.04, "Taxi": 2345.84, "Taxi - Efectivo": 659.9300000000001}}, "Hidalgo": {"total": 2652.08, "types": {"Comida local": 1121.0, "Consumo nacional": 828.0, "Taxi": 566.98, "Taxi - Efectivo": 136.1}}, "Guanajuato": {"total": 80994.73, "types": {"Autob\u00fas": 39480.0, "Autob\u00fas - Efectivo": 1858.8, "Casetas": 64.0, "Casetas - Efectivo": 76.0, "Comida local": 992.38, "Comida local - Efectivo": 393.0, "Consumo nacional": 11839.86, "Consumo nacional - Efectivo": 62.0, "Estacionamiento - Efectivo": 50.0, "Gasolina": 6829.08, "Hotel": 17009.07, "Otros gastos": 49.0, "Taxi": 1979.7, "Taxi - Efectivo": 311.84000000000003}}, "Tamaulipas": {"total": 41201.759999999995, "types": {"Autob\u00fas": 1687.0, "Comida local": 3382.5299999999997, "Comida local - Efectivo": 407.0, "Consumo nacional": 2504.64, "Consumo nacional - Efectivo": 2727.51, "Estacionamiento - Efectivo": 111.5, "Hotel": 20790.29, "Otros gastos": 522.16, "Taxi": 2634.32, "Taxi - Efectivo": 6434.8099999999995}}, "Sonora": {"total": 44912.99, "types": {"Autob\u00fas": 4898.0, "Comida local": 1628.99, "Consumo nacional": 8399.11, "Consumo nacional - Efectivo": 929.99, "Hotel": 23430.51, "Otros gastos": 606.4300000000001, "Taxi": 3697.5099999999998, "Taxi - Efectivo": 1322.45}}, "Chihuahua": {"total": 23517.469999999998, "types": {"Comida local": 335.0, "Comida local - Efectivo": 120.0, "Consumo nacional": 2553.01, "Hotel": 14931.97, "Taxi": 3960.83, "Taxi - Efectivo": 1616.6599999999999}}, "Colima": {"total": 10750.990000000002, "types": {"Consumo nacional": 5479.27, "Consumo nacional - Efectivo": 859.0, "Gasolina": 3085.45, "Hotel": 1175.0, "Taxi": 152.26999999999998}}, "Quer\u00e9taro": {"total": 31196.329999999998, "types": {"Autob\u00fas": 832.0, "Comida local": 1601.0, "Consumo nacional": 8274.5, "Estacionamiento - Efectivo": 25.0, "Evento": 50.0, "Gasolina": 3617.49, "Hotel": 3955.13, "Otros gastos": 2561.73, "Taxi": 5510.4800000000005, "Taxi - Efectivo": 4769.0}}, "San Luis Potos\u00ed": {"total": 19676.39, "types": {"Casetas - Efectivo": 1499.0, "Consumo nacional": 4557.12, "Consumo nacional - Efectivo": 189.0, "Estacionamiento - Efectivo": 180.03, "Gasolina": 4110.4, "Hotel": 8150.57, "Taxi": 990.27}}, "Michoac\u00e1n de Ocampo": {"total": 24391.809999999998, "types": {"Autob\u00fas": 1032.0, "Comida local": 233.0, "Consumo nacional": 5789.57, "Consumo nacional - Efectivo": 1064.91, "Gasolina": 2138.92, "Hotel": 5177.11, "Otros gastos": 50.0, "Taxi": 5685.86, "Taxi - Efectivo": 3220.44}}, "Durango": {"total": 18752.11, "types": {"Autob\u00fas": 536.0, "Comida local": 199.0, "Consumo nacional": 2213.11, "Consumo nacional - Efectivo": 464.0, "Hotel": 10834.0, "Otros gastos": 558.01, "Taxi": 3947.99}}, "Nuevo Le\u00f3n": {"total": 133232.46, "types": {"Autob\u00fas": 7524.0, "Autob\u00fas - Efectivo": 1354.0, "Avi\u00f3n": 1897.81, "Casetas - Efectivo": 180.0, "Comida local": 2839.0, "Comida local - Efectivo": 44.0, "Consumo nacional": 18467.86, "Consumo nacional - Efectivo": 2709.49, "Gasolina": 4300.0, "Hotel": 47681.86, "Hotel - Efectivo": 4284.0, "Otros gastos": 1006.0, "Otros gastos - Efectivo": 518.65, "Taxi": 26962.36, "Taxi - Efectivo": 13463.43}}, "Puebla": {"total": 39131.17, "types": {"Autob\u00fas": 4750.0, "Comida local": 2469.51, "Comida local - Efectivo": 218.0, "Consumo nacional": 9909.91, "Consumo nacional - Efectivo": 555.0, "Hotel": 10402.82, "Otros gastos": 2102.6099999999997, "Taxi": 3944.99, "Taxi - Efectivo": 4778.33}}, "Nayarit": {"total": 2460.37, "types": {"Consumo nacional": 674.0, "Taxi": 974.37, "Taxi - Efectivo": 812.0}}, "Baja California Sur": {"total": 86669.08, "types": {"Autob\u00fas": 2250.5, "Consumo nacional": 11938.36, "Consumo nacional - Efectivo": 1923.0, "Hotel": 37182.87, "Otros gastos": 324.95, "Taxi": 24754.4, "Taxi - Efectivo": 8295.0}}, "Tlaxcala": {"total": 10973.33, "types": {"Autob\u00fas": 3340.0, "Comida local": 774.0, "Consumo nacional": 1886.0, "Consumo nacional - Efectivo": 238.0, "Hotel": 3868.3199999999997, "Otros gastos - Efectivo": 39.0, "Taxi": 792.2, "Taxi - Efectivo": 35.81}}, "Coahuila de Zaragoza": {"total": 35367.84, "types": {"Autob\u00fas": 571.0, "Comida local": 1695.01, "Consumo nacional": 6004.55, "Consumo nacional - Efectivo": 1002.0, "Hotel": 19757.32, "Hotel - Efectivo": 945.0, "Taxi": 3500.62, "Taxi - Efectivo": 1892.34}}, "Tabasco": {"total": 21415.37, "types": {"Comida local": 1006.0, "Consumo nacional": 4036.01, "Consumo nacional - Efectivo": 689.3, "Hotel": 12819.65, "Taxi": 1073.42, "Taxi - Efectivo": 1790.99}}, "Guerrero": {"total": 68579.25, "types": {"Comida local": 1939.01, "Comida local - Efectivo": 488.5, "Consumo nacional": 9236.66, "Consumo nacional - Efectivo": 2216.41, "Hotel": 28620.98, "Taxi": 447.69, "Taxi - Efectivo": 25630.0}}, "Chiapas": {"total": 51271.9, "types": {"Comida local": 840.0, "Consumo nacional": 10064.14, "Consumo nacional - Efectivo": 774.5, "Hotel": 26645.93, "Taxi": 9891.289999999999, "Taxi - Efectivo": 3056.04}}, "Campeche": {"total": 24127.65, "types": {"Comida local": 925.0, "Consumo nacional": 2737.98, "Consumo nacional - Efectivo": 291.90999999999997, "Hotel": 13604.76, "Taxi": 1828.0, "Taxi - Efectivo": 4740.0}}, "Morelos": {"total": 3426.84, "types": {"Consumo nacional": 995.99, "Consumo nacional - Efectivo": 300.0, "Hotel": 990.0, "Taxi": 708.32, "Taxi - Efectivo": 432.53}}, "Zacatecas": {"total": 440.0, "types": {"Taxi - Efectivo": 440.0}}}, "users": {"Cesar Mendoza": {"total": 204390.19, "noDeducible": 45387.73, "categories": {"Autob\u00fas": 16121.0, "Autob\u00fas - Efectivo": 358.0, "Avi\u00f3n": 8695.96, "Comida local": 10993.71, "Comida local - Efectivo": 1306.0, "Consumo nacional": 12714.98, "Consumo nacional - Efectivo": 6451.22, "Estacionamiento - Efectivo": 111.5, "Hotel": 41074.03, "Otros gastos": 3993.83, "Otros gastos - Efectivo": 869.99, "Sin comprobante CFDI": 42479.73, "Sin comprobante CFDI - Efectivo": 2908.0, "Taxi": 41809.13, "Taxi - Efectivo": 14503.11}}, "Diego Ceballos": {"total": 20140.57, "noDeducible": 80.0, "categories": {"Autob\u00fas - Efectivo": 5463.0, "Comida local - Efectivo": 733.4, "Consumo nacional - Efectivo": 11902.17, "Sin comprobante CFDI - Efectivo": 80.0, "Taxi - Efectivo": 1962.0}}, "Emmanuel Ramirez": {"total": 25872.0, "noDeducible": 1028.13, "categories": {"Alimentos sin comprobante": 10.2, "Autob\u00fas": 4620.0, "Casetas - Efectivo": 2146.0, "Comida local": 1802.0, "Consumo nacional": 2352.01, "Consumo nacional - Efectivo": 310.52, "Gasolina": 2302.35, "Hotel": 4648.65, "Sin comprobante CFDI": 770.49, "Sin comprobante CFDI - Efectivo": 247.44, "Taxi": 6597.34, "Taxi - Efectivo": 65.0}}, "Gustavo Gomez": {"total": 273750.3, "noDeducible": 13200.3, "categories": {"Alimentos sin comprobante": 1092.72, "Alimentos sin comprobante - Efectivo": 85.0, "Autob\u00fas": 12621.57, "Autob\u00fas - Efectivo": 497.0, "Casetas": 64.0, "Casetas - Efectivo": 10547.0, "Comida local": 7962.01, "Comida local - Efectivo": 467.0, "Consumo nacional": 29605.68, "Consumo nacional - Efectivo": 3641.31, "Estacionamiento - Efectivo": 75.01, "Gasolina": 13445.619999999999, "Hotel": 86944.64, "Hotel - Efectivo": 2249.9700000000003, "Otros gastos": 1693.95, "Otros gastos - Efectivo": 518.65, "Propina": 26.4, "Sin comprobante CFDI": 7914.7300000000005, "Sin comprobante CFDI - Efectivo": 4081.45, "Taxi": 69085.39, "Taxi - Efectivo": 21131.2}}, "Iv\u00e1n \u00c1ngel Pacheco": {"total": 72058.35, "noDeducible": 3551.73, "categories": {"Alimentos sin comprobante": 298.0, "Autob\u00fas": 14549.2, "Autob\u00fas - Efectivo": 1858.8, "Comida local": 936.0, "Consumo nacional": 7731.67, "Consumo nacional - Efectivo": 5937.91, "Hotel": 14555.86, "Hotel - Efectivo": 5553.16, "Otros gastos": 1769.65, "Sin comprobante CFDI": 1327.84, "Sin comprobante CFDI - Efectivo": 1925.8899999999999, "Taxi": 11376.11, "Taxi - Efectivo": 4238.26}}, "Jesus Gerado Castellanos Martinez": {"total": 254583.46, "noDeducible": 6483.47, "categories": {"Alimentos sin comprobante": 124.0, "Autob\u00fas": 5474.4, "Casetas": 1581.0, "Casetas - Efectivo": 32720.0, "Consumo nacional": 32432.33, "Consumo nacional - Efectivo": 1677.5, "Estacionamiento - Efectivo": 402.03, "Gasolina": 33231.88, "Hotel": 65171.89, "Otros gastos": 119.0, "Sin comprobante CFDI": 4514.23, "Sin comprobante CFDI - Efectivo": 1845.24, "Taxi": 68839.12, "Taxi - Efectivo": 6450.84}}, "Jes\u00fas David Cruz Uribe": {"total": 268705.3, "noDeducible": 52971.23, "categories": {"Alimentos sin comprobante": 30.84, "Autob\u00fas": 17767.99, "Autob\u00fas - Efectivo": 310.0, "Casetas - Efectivo": 120.0, "Comida local": 2440.5, "Comida local - Efectivo": 44.0, "Consumo nacional": 31159.36, "Consumo nacional - Efectivo": 271.0, "Hotel": 57244.54, "Otros gastos": 3235.26, "Sin comprobante CFDI": 44310.67, "Sin comprobante CFDI - Efectivo": 8629.720000000001, "Taxi": 1176.22, "Taxi - Efectivo": 101965.2}}, "Jorge Bustamante Alonso": {"total": 8794.26, "noDeducible": 469.32, "categories": {"Autob\u00fas": 1483.0, "Comida local": 3844.9700000000003, "Hotel": 1854.0, "Sin comprobante CFDI": 294.32, "Sin comprobante CFDI - Efectivo": 175.0, "Taxi": 1142.97}}, "Jos\u00e9 Eduardo Monta\u00f1o Cervantes": {"total": 94396.96, "noDeducible": 4403.76, "categories": {"Alimentos sin comprobante - Efectivo": 455.0, "Autob\u00fas": 35396.4, "Autob\u00fas - Efectivo": 1289.5, "Comida local": 448.0, "Consumo nacional": 18892.18, "Consumo nacional - Efectivo": 448.0, "Hotel": 15674.3, "Otros gastos": 891.08, "Sin comprobante CFDI": 3690.31, "Sin comprobante CFDI - Efectivo": 258.45, "Taxi": 12886.89, "Taxi - Efectivo": 4066.85}}, "Jos\u00e9 de Jesus Coronado": {"total": 296014.24, "noDeducible": 10524.02, "categories": {"Alimentos sin comprobante": 331.32, "Autob\u00fas": 5035.0, "Casetas - Efectivo": 25689.0, "Comida local": 8910.14, "Comida local - Efectivo": 1000.0, "Consumo nacional": 35324.69, "Consumo nacional - Efectivo": 2137.0, "Estacionamiento - Efectivo": 50.0, "Evento": 50.0, "Gasolina": 30703.39, "Hotel": 70126.74, "Otros gastos": 1560.8600000000001, "Otros gastos - Efectivo": 1780.0, "Propina": 182.0, "Sin comprobante CFDI": 8057.6, "Sin comprobante CFDI - Efectivo": 1953.1, "Taxi": 92155.36, "Taxi - Efectivo": 10968.04}}, "Juan Andr\u00e9s Pineda": {"total": 181727.63, "noDeducible": 9386.23, "categories": {"Autob\u00fas": 5531.5, "Comida local": 666.0, "Consumo nacional": 23473.56, "Consumo nacional - Efectivo": 3480.5, "Hotel": 57669.56, "Otros gastos": 1543.0, "Sin comprobante CFDI": 7902.89, "Sin comprobante CFDI - Efectivo": 1483.34, "Taxi": 71062.28, "Taxi - Efectivo": 8915.0}}, "Luis Enrique Garcia Solis": {"total": 71217.36, "noDeducible": 2138.05, "categories": {"Alimentos sin comprobante": 145.0, "Alimentos sin comprobante - Efectivo": 201.0, "Autob\u00fas": 14780.0, "Autob\u00fas - Efectivo": 1354.0, "Comida local": 6082.24, "Comida local - Efectivo": 120.0, "Consumo nacional": 5701.5, "Consumo nacional - Efectivo": 224.0, "Gasolina": 4800.0, "Hotel": 17756.1, "Otros gastos": 1164.6, "Propina": 167.79999999999998, "Sin comprobante CFDI": 1247.43, "Sin comprobante CFDI - Efectivo": 376.82, "Taxi": 14467.86, "Taxi - Efectivo": 2629.01}}, "Miguel \u00c1ngel Hern\u00e1ndez": {"total": 10800.09, "noDeducible": 0.0, "categories": {"Consumo nacional - Efectivo": 10400.09, "Taxi - Efectivo": 400.0}}, "Ramon Fregoso": {"total": 212032.53, "noDeducible": 5372.73, "categories": {"Alimentos sin comprobante": 14.200000000000001, "Autob\u00fas": 28887.0, "Autob\u00fas - Efectivo": 2380.0, "Avi\u00f3n": 1897.81, "Casetas - Efectivo": 878.0, "Comida local": 6734.68, "Comida local - Efectivo": 246.8, "Consumo nacional": 22008.14, "Consumo nacional - Efectivo": 7353.01, "Gasolina": 1263.3899999999999, "Hotel": 68884.54, "Hotel - Efectivo": 8541.0, "Otros gastos": 942.5699999999999, "Propina": 25.99, "Sin comprobante CFDI": 3205.17, "Sin comprobante CFDI - Efectivo": 2127.37, "Taxi": 47090.770000000004, "Taxi - Efectivo": 9552.09}}, "Roberto Reyna": {"total": 3700.0, "noDeducible": 3700.0, "categories": {"Sin comprobante CFDI": 3700.0}}, "Rodrigo Macias": {"total": 64477.13, "noDeducible": 2218.51, "categories": {"Autob\u00fas": 100.0, "Autob\u00fas - Efectivo": 80.0, "Casetas - Efectivo": 6510.0, "Comida local": 4469.94, "Consumo nacional": 9483.2, "Estacionamiento": 165.0, "Estacionamiento - Efectivo": 610.0, "Gasolina": 5281.99, "Hotel": 19549.09, "Otros gastos": 169.5, "Sin comprobante CFDI": 1897.79, "Sin comprobante CFDI - Efectivo": 320.72, "Taxi": 15133.8, "Taxi - Efectivo": 706.0999999999999}}, "Timoteo Rivera": {"total": 86687.55, "noDeducible": 14540.82, "categories": {"Autob\u00fas": 16312.01, "Autob\u00fas - Efectivo": 1498.0, "Comida local": 6037.0, "Comida local - Efectivo": 135.0, "Consumo nacional": 4770.0, "Hotel": 5410.0, "Sin comprobante CFDI": 9322.3, "Sin comprobante CFDI - Efectivo": 5218.52, "Taxi": 499.89, "Taxi - Efectivo": 37484.83}}, "\u00c1ngel Alexis Rivera": {"total": 296052.66, "noDeducible": 47976.42, "categories": {"Autob\u00fas": 28169.0, "Autob\u00fas - Efectivo": 676.0, "Comida local": 4332.0, "Comida local - Efectivo": 177.0, "Consumo nacional": 30220.79, "Consumo nacional - Efectivo": 8997.59, "Hotel": 58221.9, "Otros gastos": 2353.73, "Otros gastos - Efectivo": 244.39, "Propina": 34.8, "Sin comprobante CFDI": 41697.78, "Sin comprobante CFDI - Efectivo": 6243.84, "Taxi": 20742.19, "Taxi - Efectivo": 93941.65}}}, "categories": {"Alimentos sin comprobante": 2046.28, "Alimentos sin comprobante - Efectivo": 741.0, "Autob\u00fas": 206848.07, "Autob\u00fas - Efectivo": 15764.3, "Avi\u00f3n": 10593.769999999999, "Casetas": 1645.0, "Casetas - Efectivo": 78610.0, "Comida local": 65659.19, "Comida local - Efectivo": 4229.2, "Consumo nacional": 265870.09, "Consumo nacional - Efectivo": 63231.82, "Estacionamiento": 165.0, "Estacionamiento - Efectivo": 1248.54, "Evento": 50.0, "Gasolina": 91028.62, "Hotel": 584785.84, "Hotel - Efectivo": 16344.130000000001, "Otros gastos": 19437.03, "Otros gastos - Efectivo": 3413.0299999999997, "Propina": 436.99, "Sin comprobante CFDI": 182333.28, "Sin comprobante CFDI - Efectivo": 37874.9, "Taxi": 474065.32, "Taxi - Efectivo": 318979.18}, "cost_centers": {"Tecnicos": 2441700.58, "Ventas": 3700.0}, "audit": {"providers": [{"name": "GABRIEL IBARRA NANDO", "total": 115083.37999999999, "cat": "Taxi, Taxi - Efectivo"}, {"name": "SERVICIOS CENTRALES DE COBRANZA HOTELERA", "total": 63631.51, "cat": "Hotel"}, {"name": "DIGITAL SOLUTIONS AMERICAS", "total": 63043.51, "cat": "Taxi, Taxi - Efectivo"}, {"name": "INMOBILIARIA RUIZ SOUZA", "total": 55037.65, "cat": "Hotel, Consumo nacional - Efectivo"}, {"name": "RED DE CARRETERAS DE OCCIDENTE", "total": 50841.0, "cat": "Casetas - Efectivo, Consumo nacional"}], "weekend": {"weekend": 246509.68000000002, "weekday": 2198890.9}, "payment": {"Tarjeta Corporativa": {"Pago Total": 2436606.32, "No Deducible": 222963.13}, "Tarjeta Personal": {"Pago Total": 8794.26, "No Deducible": 469.32}}}}, "all": {"total": 4459714.95, "deducible": 4065527.12, "noDeducible": 394187.83, "comprobantes": 11829, "viajes": 1312, "months": {"2024-01": {"total": 103654.19, "noDeducible": 4688.88}, "2024-02": {"total": 108503.65, "noDeducible": 5537.91}, "2024-03": {"total": 167272.72, "noDeducible": 14385.79}, "2024-04": {"total": 175300.47, "noDeducible": 18951.76}, "2024-05": {"total": 79534.02, "noDeducible": 12678.44}, "2024-06": {"total": 124379.08, "noDeducible": 11683.13}, "2024-07": {"total": 125930.73, "noDeducible": 11045.28}, "2024-08": {"total": 196458.13999999998, "noDeducible": 15353.15}, "2024-09": {"total": 176696.53, "noDeducible": 15150.52}, "2024-10": {"total": 280678.49, "noDeducible": 22826.15}, "2024-11": {"total": 240528.36, "noDeducible": 19181.8}, "2024-12": {"total": 235377.99, "noDeducible": 19272.57}, "2025-01": {"total": 193239.68, "noDeducible": 26159.02}, "2025-02": {"total": 193541.78, "noDeducible": 17525.74}, "2025-03": {"total": 199560.18, "noDeducible": 21439.06}, "2025-04": {"total": 233609.52, "noDeducible": 19938.84}, "2025-05": {"total": 248992.03, "noDeducible": 22932.1}, "2025-06": {"total": 214840.69, "noDeducible": 16475.85}, "2025-07": {"total": 242036.86, "noDeducible": 18099.420000000002}, "2025-08": {"total": 204966.15, "noDeducible": 14469.31}, "2025-09": {"total": 177646.76, "noDeducible": 14633.460000000001}, "2025-10": {"total": 182413.46, "noDeducible": 19702.12}, "2025-11": {"total": 171576.92, "noDeducible": 17150.0}, "2025-12": {"total": 182976.55, "noDeducible": 14907.53}}, "states": {"SinCP": {"total": 462972.62, "types": {"Alimentos sin comprobante": 7752.07, "Alimentos sin comprobante - Efectivo": 741.0, "Casetas": 270.0, "Casetas - Efectivo": 285.0, "Comida local": 4920.0, "Consumo nacional": 8368.09, "Consumo nacional - Efectivo": 1726.1399999999999, "Gasolina": 3401.91, "Hotel": 18887.04, "Otros gastos": 2605.0099999999998, "Propina": 749.59, "Sin comprobante CFDI": 335521.36, "Sin comprobante CFDI - Efectivo": 49423.81, "Taxi": 21093.09, "Taxi - Efectivo": 7228.51}}, "Chihuahua": {"total": 44475.81, "types": {"Autob\u00fas": 934.0, "Comida local": 1311.0, "Comida local - Efectivo": 120.0, "Consumo nacional": 3755.01, "Hotel": 25903.14, "Taxi": 10836.0, "Taxi - Efectivo": 1616.6599999999999}}, "Jalisco": {"total": 1040600.3200000001, "types": {"Autob\u00fas": 54198.01, "Autob\u00fas - Efectivo": 1836.0, "Casetas": 17326.0, "Casetas - Efectivo": 55928.0, "Comida local": 60071.62, "Comida local - Efectivo": 1082.2, "Consumo nacional": 155397.92, "Consumo nacional - Efectivo": 31148.09, "Estacionamiento": 330.0, "Estacionamiento - Efectivo": 765.01, "Gasolina": 86753.17, "Hotel": 189480.88, "Hotel - Efectivo": 3312.0, "Otros gastos": 4383.56, "Taxi": 371501.07, "Taxi - Efectivo": 6786.8099999999995, "Telefono": 299.98}}, "Quer\u00e9taro": {"total": 58602.02, "types": {"Autob\u00fas": 832.0, "Comida local": 5663.0, "Consumo nacional": 16598.99, "Estacionamiento - Efectivo": 50.0, "Evento": 50.0, "Gasolina": 5579.92, "Hotel": 8997.95, "Otros gastos": 2730.73, "Taxi": 13330.43, "Taxi - Efectivo": 4769.0}}, "Ciudad de M\u00e9xico": {"total": 651990.32, "types": {"Autob\u00fas": 187030.61, "Autob\u00fas - Efectivo": 9565.5, "Avi\u00f3n": 9905.96, "Casetas": 3139.0, "Casetas - Efectivo": 30915.0, "Comida local": 24919.5, "Comida local - Efectivo": 1217.0, "Consumo nacional": 35529.45, "Consumo nacional - Efectivo": 8708.08, "Estacionamiento": 156.0, "Estacionamiento - Efectivo": 227.0, "Hotel": 72433.77, "Hotel - Efectivo": 6853.16, "Otros gastos": 8089.110000000001, "Otros gastos - Efectivo": 906.99, "Taxi": 148111.36, "Taxi - Efectivo": 104282.83}}, "M\u00e9xico": {"total": 270527.26, "types": {"Autob\u00fas": 14402.0, "Autob\u00fas - Efectivo": 930.0, "Comida local": 7381.49, "Consumo nacional": 15604.17, "Consumo nacional - Efectivo": 933.8, "Hotel": 67026.92, "Otros gastos": 3433.13, "Taxi": 113328.95, "Taxi - Efectivo": 47486.8}}, "Guanajuato": {"total": 188601.55999999997, "types": {"Autob\u00fas": 107781.4, "Autob\u00fas - Efectivo": 1858.8, "Casetas": 136.0, "Casetas - Efectivo": 76.0, "Comida local": 3801.2799999999997, "Comida local - Efectivo": 393.0, "Consumo nacional": 24702.46, "Consumo nacional - Efectivo": 62.0, "Estacionamiento": 585.0, "Estacionamiento - Efectivo": 50.0, "Gasolina": 12693.43, "Hotel": 29568.99, "Otros gastos": 1430.7399999999998, "Taxi": 5150.62, "Taxi - Efectivo": 311.84000000000003}}, "Baja California Sur": {"total": 112104.1, "types": {"Autob\u00fas": 2620.5, "Comida local": 342.0, "Consumo nacional": 18209.36, "Consumo nacional - Efectivo": 1923.0, "Gasolina": 1508.95, "Hotel": 49276.87, "Otros gastos": 324.95, "Taxi": 29603.47, "Taxi - Efectivo": 8295.0}}, "Aguascalientes": {"total": 92579.84, "types": {"Autob\u00fas": 59001.0, "Autob\u00fas - Efectivo": 2584.0, "Comida local": 1551.25, "Consumo nacional": 7058.8, "Gasolina": 5427.45, "Hotel": 16412.44, "Taxi": 422.65000000000003, "Taxi - Efectivo": 122.25}}, "Veracruz de Ignacio de la Llave": {"total": 93231.28, "types": {"Comida local": 4736.8, "Comida local - Efectivo": 38.0, "Consumo nacional": 14605.93, "Consumo nacional - Efectivo": 1766.99, "Hotel": 46648.24, "Otros gastos": 2255.6800000000003, "Otros gastos - Efectivo": 168.39, "Taxi": 10094.55, "Taxi - Efectivo": 12916.7}}, "Nayarit": {"total": 18927.559999999998, "types": {"Autob\u00fas": 611.0, "Consumo nacional": 1636.51, "Taxi": 15868.05, "Taxi - Efectivo": 812.0}}, "Michoac\u00e1n de Ocampo": {"total": 50928.05, "types": {"Autob\u00fas": 1842.0, "Comida local": 1372.0, "Consumo nacional": 14744.56, "Consumo nacional - Efectivo": 1064.91, "Gasolina": 2723.5, "Hotel": 11604.16, "Otros gastos": 50.0, "Taxi": 13967.12, "Taxi - Efectivo": 3559.8}}, "Coahuila de Zaragoza": {"total": 54028.130000000005, "types": {"Autob\u00fas": 1278.0, "Comida local": 4637.02, "Comida local - Efectivo": 161.0, "Consumo nacional": 7674.55, "Consumo nacional - Efectivo": 1756.2, "Hotel": 28572.06, "Hotel - Efectivo": 1794.0, "Otros gastos": 406.46000000000004, "Taxi": 5441.5, "Taxi - Efectivo": 2307.34}}, "Tlaxcala": {"total": 23480.39, "types": {"Autob\u00fas": 6740.0, "Comida local": 1849.0, "Consumo nacional": 3756.2799999999997, "Consumo nacional - Efectivo": 238.0, "Hotel": 9048.31, "Otros gastos - Efectivo": 39.0, "Taxi": 1773.99, "Taxi - Efectivo": 35.81}}, "Nuevo Le\u00f3n": {"total": 174961.31999999998, "types": {"Autob\u00fas": 7524.0, "Autob\u00fas - Efectivo": 2194.0, "Avi\u00f3n": 1897.81, "Casetas - Efectivo": 180.0, "Comida local": 2839.0, "Comida local - Efectivo": 44.0, "Consumo nacional": 20975.35, "Consumo nacional - Efectivo": 2796.49, "Gasolina": 11750.0, "Hotel": 52481.86, "Hotel - Efectivo": 4284.0, "Otros gastos": 2770.66, "Otros gastos - Efectivo": 518.65, "Taxi": 49774.53, "Taxi - Efectivo": 14930.97}}, "San Luis Potos\u00ed": {"total": 37544.54, "types": {"Casetas": 228.0, "Casetas - Efectivo": 1883.0, "Comida local": 558.0, "Consumo nacional": 14832.52, "Consumo nacional - Efectivo": 189.0, "Estacionamiento - Efectivo": 180.03, "Gasolina": 4110.4, "Hotel": 11703.97, "Taxi": 3859.62}}, "Puebla": {"total": 50105.32, "types": {"Autob\u00fas": 7322.0, "Comida local": 6329.5, "Comida local - Efectivo": 218.0, "Consumo nacional": 10522.91, "Consumo nacional - Efectivo": 555.0, "Hotel": 10402.82, "Otros gastos": 2372.79, "Taxi": 7459.23, "Taxi - Efectivo": 4923.07}}, "Tabasco": {"total": 56288.81999999999, "types": {"Comida local": 4133.0, "Consumo nacional": 8338.29, "Consumo nacional - Efectivo": 689.3, "Hotel": 34201.64, "Otros gastos": 125.0, "Taxi": 7010.599999999999, "Taxi - Efectivo": 1790.99}}, "Sonora": {"total": 78707.48999999999, "types": {"Autob\u00fas": 5762.0, "Autob\u00fas - Efectivo": 484.0, "Comida local": 3064.99, "Consumo nacional": 15286.2, "Consumo nacional - Efectivo": 2518.0, "Hotel": 37847.58, "Hotel - Efectivo": 1245.0, "Lavander\u00eda": 1760.0, "Otros gastos": 606.4300000000001, "Taxi": 8283.03, "Taxi - Efectivo": 1850.26}}, "Sinaloa": {"total": 36780.549999999996, "types": {"Autob\u00fas": 551.0, "Autob\u00fas - Efectivo": 80.0, "Consumo nacional": 10266.72, "Consumo nacional - Efectivo": 307.52, "Hotel": 20426.43, "Taxi": 4488.95, "Taxi - Efectivo": 659.9300000000001}}, "Yucat\u00e1n": {"total": 76842.13, "types": {"Autob\u00fas": 220.01, "Comida local": 7360.01, "Comida local - Efectivo": 135.0, "Consumo nacional": 10962.64, "Consumo nacional - Efectivo": 198.0, "Hotel": 29453.95, "Otros gastos": 2113.13, "Taxi": 16464.53, "Taxi - Efectivo": 9934.86}}, "Quintana Roo": {"total": 294731.79000000004, "types": {"Comida local": 15762.99, "Comida local - Efectivo": 281.5, "Consumo nacional": 28903.88, "Consumo nacional - Efectivo": 1958.22, "Gasolina": 12631.73, "Hotel": 103521.90000000001, "Hotel - Efectivo": 2249.9700000000003, "Otros gastos": 1763.49, "Taxi": 66996.07, "Taxi - Efectivo": 60662.04}}, "Oaxaca": {"total": 43273.53, "types": {"Comida local": 3064.02, "Comida local - Efectivo": 400.0, "Consumo nacional": 2767.0, "Consumo nacional - Efectivo": 1217.75, "Hotel": 20756.32, "Otros gastos": 535.24, "Otros gastos - Efectivo": 1780.0, "Taxi": 10848.2, "Taxi - Efectivo": 1905.0}}, "Baja California": {"total": 104493.94, "types": {"Autob\u00fas": 6429.0, "Comida local": 4961.5, "Consumo nacional": 14320.9, "Consumo nacional - Efectivo": 1048.87, "Hotel": 11215.34, "Otros gastos": 1663.6399999999999, "Taxi": 64154.69, "Taxi - Efectivo": 700.0}}, "Morelos": {"total": 5634.329999999999, "types": {"Comida local": 319.0, "Consumo nacional": 1322.99, "Consumo nacional - Efectivo": 300.0, "Hotel": 990.0, "Otros gastos": 444.81, "Taxi": 1825.0, "Taxi - Efectivo": 432.53}}, "Guerrero": {"total": 119849.61000000002, "types": {"Autob\u00fas": 200.0, "Comida local": 5343.02, "Comida local - Efectivo": 488.5, "Consumo nacional": 17683.49, "Consumo nacional - Efectivo": 2390.91, "Hotel": 52016.979999999996, "Otros gastos": 405.0, "Taxi": 10921.71, "Taxi - Efectivo": 30400.0}}, "Tamaulipas": {"total": 67032.53, "types": {"Autob\u00fas": 3964.0, "Comida local": 4207.53, "Comida local - Efectivo": 407.0, "Consumo nacional": 6936.54, "Consumo nacional - Efectivo": 3171.0, "Estacionamiento - Efectivo": 111.5, "Hotel": 36593.33, "Otros gastos": 522.16, "Taxi": 4588.08, "Taxi - Efectivo": 6531.389999999999}}, "Durango": {"total": 23309.379999999997, "types": {"Autob\u00fas": 536.0, "Comida local": 199.0, "Consumo nacional": 2873.11, "Consumo nacional - Efectivo": 464.0, "Hotel": 13484.0, "Otros gastos": 558.01, "Taxi": 5195.26}}, "Hidalgo": {"total": 5347.460000000001, "types": {"Comida local": 2435.0, "Consumo nacional": 1559.0, "Taxi": 1217.3600000000001, "Taxi - Efectivo": 136.1}}, "Chiapas": {"total": 77335.90000000001, "types": {"Autob\u00fas": 370.0, "Comida local": 1636.0, "Consumo nacional": 14788.16, "Consumo nacional - Efectivo": 774.5, "Hotel": 40098.93, "Otros gastos": 246.98000000000002, "Taxi": 16365.29, "Taxi - Efectivo": 3056.04}}, "Colima": {"total": 13459.510000000002, "types": {"Comida local": 385.0, "Consumo nacional": 6551.27, "Consumo nacional - Efectivo": 859.0, "Gasolina": 3085.45, "Hotel": 2325.0, "Taxi": 253.79}}, "Campeche": {"total": 26674.29, "types": {"Comida local": 925.0, "Consumo nacional": 3166.48, "Consumo nacional - Efectivo": 291.90999999999997, "Hotel": 15091.56, "Taxi": 2109.34, "Taxi - Efectivo": 5090.0}}, "Zacatecas": {"total": 4293.25, "types": {"Consumo nacional": 1058.0, "Hotel": 2663.22, "Taxi": 132.03, "Taxi - Efectivo": 440.0}}}, "users": {"Alfonso Caballero Chavez": {"total": 10265.17, "noDeducible": 0.0, "categories": {"Comida local": 5251.39, "Consumo nacional": 5013.78}}, "Cesar Mendoza": {"total": 476173.39, "noDeducible": 90861.99, "categories": {"Alimentos sin comprobante": 1136.0, "Autob\u00fas": 59579.5, "Autob\u00fas - Efectivo": 358.0, "Avi\u00f3n": 8695.96, "Casetas": 175.0, "Comida local": 33110.62, "Comida local - Efectivo": 1306.0, "Consumo nacional": 29738.35, "Consumo nacional - Efectivo": 6937.62, "Estacionamiento - Efectivo": 111.5, "Hotel": 92090.03, "Otros gastos": 7017.719999999999, "Otros gastos - Efectivo": 869.99, "Sin comprobante CFDI": 85293.39, "Sin comprobante CFDI - Efectivo": 4432.6, "Taxi": 127848.0, "Taxi - Efectivo": 17473.11}}, "Diego Ceballos": {"total": 20140.57, "noDeducible": 80.0, "categories": {"Autob\u00fas - Efectivo": 5463.0, "Comida local - Efectivo": 733.4, "Consumo nacional - Efectivo": 11902.17, "Sin comprobante CFDI - Efectivo": 80.0, "Taxi - Efectivo": 1962.0}}, "Diego Hern\u00e1ndez": {"total": 125276.82, "noDeducible": 38788.1, "categories": {"Alimentos sin comprobante": 1112.0, "Autob\u00fas": 14483.0, "Comida local": 10968.03, "Consumo nacional": 17220.77, "Hotel": 15193.59, "Otros gastos": 4445.22, "Sin comprobante CFDI": 37676.1, "Taxi": 24178.11}}, "Emmanuel Ramirez": {"total": 32347.23, "noDeducible": 1472.73, "categories": {"Alimentos sin comprobante": 10.2, "Autob\u00fas": 4620.0, "Casetas - Efectivo": 2146.0, "Comida local": 2576.0, "Consumo nacional": 3475.01, "Consumo nacional - Efectivo": 310.52, "Gasolina": 3127.37, "Hotel": 6423.65, "Sin comprobante CFDI": 1215.0900000000001, "Sin comprobante CFDI - Efectivo": 247.44, "Taxi": 8130.95, "Taxi - Efectivo": 65.0}}, "Gustavo Gomez": {"total": 603668.16, "noDeducible": 19700.19, "categories": {"Alimentos sin comprobante": 1131.69, "Alimentos sin comprobante - Efectivo": 85.0, "Autob\u00fas": 30965.57, "Autob\u00fas - Efectivo": 497.0, "Casetas": 8548.0, "Casetas - Efectivo": 13033.0, "Comida local": 14308.51, "Comida local - Efectivo": 644.0, "Consumo nacional": 62185.21, "Consumo nacional - Efectivo": 4051.82, "Estacionamiento - Efectivo": 75.01, "Gasolina": 27214.57, "Hotel": 194456.83, "Hotel - Efectivo": 2249.9700000000003, "Otros gastos": 1693.95, "Otros gastos - Efectivo": 518.65, "Propina": 26.4, "Sin comprobante CFDI": 13994.41, "Sin comprobante CFDI - Efectivo": 4462.69, "Taxi": 201394.68, "Taxi - Efectivo": 22131.2}}, "Iv\u00e1n \u00c1ngel Pacheco": {"total": 72058.35, "noDeducible": 3551.73, "categories": {"Alimentos sin comprobante": 298.0, "Autob\u00fas": 14549.2, "Autob\u00fas - Efectivo": 1858.8, "Comida local": 936.0, "Consumo nacional": 7731.67, "Consumo nacional - Efectivo": 5937.91, "Hotel": 14555.86, "Hotel - Efectivo": 5553.16, "Otros gastos": 1769.65, "Sin comprobante CFDI": 1327.84, "Sin comprobante CFDI - Efectivo": 1925.8899999999999, "Taxi": 11376.11, "Taxi - Efectivo": 4238.26}}, "Jesus Gerado Castellanos Martinez": {"total": 287580.04, "noDeducible": 7216.53, "categories": {"Alimentos sin comprobante": 124.0, "Autob\u00fas": 8084.4, "Casetas": 1961.0, "Casetas - Efectivo": 34312.0, "Comida local": 937.0, "Consumo nacional": 36758.96, "Consumo nacional - Efectivo": 1677.5, "Estacionamiento": 165.0, "Estacionamiento - Efectivo": 512.03, "Gasolina": 34900.57, "Hotel": 72432.31, "Otros gastos": 119.0, "Sin comprobante CFDI": 5087.49, "Sin comprobante CFDI - Efectivo": 2005.04, "Taxi": 82052.9, "Taxi - Efectivo": 6450.84}}, "Jes\u00fas David Cruz Uribe": {"total": 291654.54, "noDeducible": 59496.05, "categories": {"Alimentos sin comprobante": 30.84, "Autob\u00fas": 18143.99, "Autob\u00fas - Efectivo": 310.0, "Casetas - Efectivo": 120.0, "Comida local": 2440.5, "Comida local - Efectivo": 44.0, "Consumo nacional": 42799.73, "Consumo nacional - Efectivo": 271.0, "Hotel": 59434.14, "Otros gastos": 3235.26, "Sin comprobante CFDI": 48298.09, "Sin comprobante CFDI - Efectivo": 11167.12, "Taxi": 3394.67, "Taxi - Efectivo": 101965.2}}, "Jorge Bustamante Alonso": {"total": 48292.57, "noDeducible": 486.32, "categories": {"Autob\u00fas": 3600.0, "Comida local": 12787.36, "Consumo nacional": 10905.39, "Hotel": 15327.58, "Sin comprobante CFDI": 311.32, "Sin comprobante CFDI - Efectivo": 175.0, "Taxi": 5185.92}}, "Jos\u00e9 Eduardo Monta\u00f1o Cervantes": {"total": 253169.52, "noDeducible": 12550.91, "categories": {"Alimentos sin comprobante": 1479.0, "Alimentos sin comprobante - Efectivo": 455.0, "Autob\u00fas": 86000.4, "Autob\u00fas - Efectivo": 1289.5, "Comida local": 9837.78, "Consumo nacional": 48863.65, "Consumo nacional - Efectivo": 899.99, "Gasolina": 1508.95, "Hotel": 44494.7, "Hotel - Efectivo": 1300.0, "Otros gastos": 3099.48, "Sin comprobante CFDI": 10164.16, "Sin comprobante CFDI - Efectivo": 452.75, "Taxi": 38465.46, "Taxi - Efectivo": 4858.7}}, "Jos\u00e9 de Jesus Coronado": {"total": 522105.26, "noDeducible": 22912.46, "categories": {"Alimentos sin comprobante": 688.32, "Autob\u00fas": 22362.5, "Casetas": 4803.0, "Casetas - Efectivo": 30934.0, "Comida local": 19380.59, "Comida local - Efectivo": 1239.0, "Consumo nacional": 60559.68, "Consumo nacional - Efectivo": 2921.75, "Estacionamiento - Efectivo": 75.0, "Evento": 50.0, "Gasolina": 42270.02, "Hotel": 118614.85, "Otros gastos": 1941.8600000000001, "Otros gastos - Efectivo": 1780.0, "Propina": 225.10000000000002, "Sin comprobante CFDI": 19890.62, "Sin comprobante CFDI - Efectivo": 2108.42, "Taxi": 180992.53, "Taxi - Efectivo": 10968.04, "Telefono": 299.98}}, "Juan Andr\u00e9s Pineda": {"total": 283330.68, "noDeducible": 13265.51, "categories": {"Autob\u00fas": 8235.5, "Comida local": 4133.4, "Consumo nacional": 50301.08, "Consumo nacional - Efectivo": 3950.51, "Hotel": 96533.52, "Otros gastos": 2310.64, "Sin comprobante CFDI": 11573.37, "Sin comprobante CFDI - Efectivo": 1692.14, "Taxi": 95685.52, "Taxi - Efectivo": 8915.0}}, "Luis Enrique Garcia Solis": {"total": 223516.22, "noDeducible": 9368.41, "categories": {"Alimentos sin comprobante": 468.32, "Alimentos sin comprobante - Efectivo": 201.0, "Autob\u00fas": 31135.0, "Autob\u00fas - Efectivo": 5122.0, "Comida local": 17409.05, "Comida local - Efectivo": 281.0, "Consumo nacional": 16808.41, "Consumo nacional - Efectivo": 3111.2, "Gasolina": 14050.0, "Hotel": 58973.54, "Hotel - Efectivo": 2094.0, "Otros gastos": 3460.7200000000003, "Propina": 396.09999999999997, "Sin comprobante CFDI": 7579.65, "Sin comprobante CFDI - Efectivo": 723.34, "Taxi": 55985.38, "Taxi - Efectivo": 5717.51}}, "Miguel \u00c1ngel Hern\u00e1ndez": {"total": 10800.09, "noDeducible": 0.0, "categories": {"Consumo nacional - Efectivo": 10400.09, "Taxi - Efectivo": 400.0}}, "Omar de Jes\u00fas Jim\u00e9nez Medrano": {"total": 31010.34, "noDeducible": 2972.04, "categories": {"Autob\u00fas": 9123.95, "Casetas": 781.0, "Comida local": 2665.89, "Consumo nacional": 1714.02, "Gasolina": 2552.95, "Hotel": 1550.0, "Otros gastos": 2788.0, "Sin comprobante CFDI": 2972.04, "Taxi": 6862.49}}, "Ramon Fregoso": {"total": 520672.41, "noDeducible": 11703.43, "categories": {"Alimentos sin comprobante": 14.200000000000001, "Autob\u00fas": 85483.51, "Autob\u00fas - Efectivo": 2380.0, "Avi\u00f3n": 3107.81, "Casetas": 4831.0, "Casetas - Efectivo": 2212.0, "Comida local": 22471.77, "Comida local - Efectivo": 425.8, "Consumo nacional": 62266.87, "Consumo nacional - Efectivo": 7412.01, "Estacionamiento": 741.0, "Gasolina": 7043.72, "Hotel": 172671.8, "Hotel - Efectivo": 8541.0, "Lavander\u00eda": 1760.0, "Otros gastos": 1574.87, "Propina": 25.99, "Sin comprobante CFDI": 8883.11, "Sin comprobante CFDI - Efectivo": 2780.13, "Taxi": 116493.73, "Taxi - Efectivo": 9552.09}}, "Roberto Reyna": {"total": 8450.0, "noDeducible": 8450.0, "categories": {"Alimentos sin comprobante": 1000.0, "Sin comprobante CFDI": 7450.0}}, "Rodrigo Macias": {"total": 64477.13, "noDeducible": 2218.51, "categories": {"Autob\u00fas": 100.0, "Autob\u00fas - Efectivo": 80.0, "Casetas - Efectivo": 6510.0, "Comida local": 4469.94, "Consumo nacional": 9483.2, "Estacionamiento": 165.0, "Estacionamiento - Efectivo": 610.0, "Gasolina": 5281.99, "Hotel": 19549.09, "Otros gastos": 169.5, "Sin comprobante CFDI": 1897.79, "Sin comprobante CFDI - Efectivo": 320.72, "Taxi": 15133.8, "Taxi - Efectivo": 706.0999999999999}}, "Timoteo Rivera": {"total": 241999.92, "noDeducible": 37436.1, "categories": {"Autob\u00fas": 41578.01, "Autob\u00fas - Efectivo": 1498.0, "Comida local": 16824.69, "Comida local - Efectivo": 135.0, "Consumo nacional": 11026.69, "Consumo nacional - Efectivo": 70.0, "Gasolina": 11715.77, "Hotel": 22757.8, "Otros gastos": 3688.1099999999997, "Propina": 41.2, "Sin comprobante CFDI": 30088.77, "Sin comprobante CFDI - Efectivo": 7306.13, "Taxi": 46084.92, "Taxi - Efectivo": 49184.83}}, "\u00c1ngel Alexis Rivera": {"total": 332726.54, "noDeducible": 51656.82, "categories": {"Alimentos sin comprobante": 259.5, "Autob\u00fas": 32104.0, "Autob\u00fas - Efectivo": 676.0, "Comida local": 5570.0, "Comida local - Efectivo": 177.0, "Consumo nacional": 43905.06, "Consumo nacional - Efectivo": 9202.59, "Hotel": 64076.31, "Otros gastos": 2522.73, "Otros gastos - Efectivo": 244.39, "Propina": 34.8, "Sin comprobante CFDI": 41818.12, "Sin comprobante CFDI - Efectivo": 9544.4, "Taxi": 23204.99, "Taxi - Efectivo": 99386.65}}}, "categories": {"Alimentos sin comprobante": 7752.07, "Alimentos sin comprobante - Efectivo": 741.0, "Autob\u00fas": 470148.53, "Autob\u00fas - Efectivo": 19532.3, "Avi\u00f3n": 11803.769999999999, "Casetas": 21099.0, "Casetas - Efectivo": 89267.0, "Comida local": 186078.52, "Comida local - Efectivo": 4985.2, "Consumo nacional": 520757.53, "Consumo nacional - Efectivo": 69056.68, "Estacionamiento": 1071.0, "Estacionamiento - Efectivo": 1383.54, "Evento": 50.0, "Gasolina": 149665.91, "Hotel": 1069135.6, "Hotel - Efectivo": 19738.13, "Lavander\u00eda": 1760.0, "Otros gastos": 39836.71, "Otros gastos - Efectivo": 3413.0299999999997, "Propina": 749.59, "Sin comprobante CFDI": 335521.36, "Sin comprobante CFDI - Efectivo": 49423.81, "Taxi": 1042470.16, "Taxi - Efectivo": 343974.53, "Telefono": 299.98}, "cost_centers": {"Tecnicos": 4451264.95, "Ventas": 8450.0}, "audit": {"providers": [{"name": "INMOBILIARIA RUIZ SOUZA", "total": 176145.36, "cat": "Hotel, Consumo nacional - Efectivo"}, {"name": "GABRIEL IBARRA NANDO", "total": 151170.18, "cat": "Taxi, Taxi - Efectivo"}, {"name": "DIGITAL SOLUTIONS AMERICAS", "total": 113478.29, "cat": "Taxi, Taxi - Efectivo"}, {"name": "AUTOBUSES DE LA PIEDAD", "total": 109557.2, "cat": "Autob\u00fas, Autob\u00fas - Efectivo"}, {"name": "JOSE FRANCISCO RAMIREZ HERRERA", "total": 103416.39, "cat": "Taxi"}], "weekend": {"weekend": 495185.05, "weekday": 3964529.9}, "payment": {"Efectivo": {"Pago Total": 317498.03, "No Deducible": 73306.01}, "Tarjeta Corporativa": {"Pago Total": 4106455.54, "No Deducible": 320395.5}, "Tarjeta Personal": {"Pago Total": 35761.38, "No Deducible": 486.32}}}}, "recommendations": {"hotel": {"current": 750.0, "unit_avg": 1711.2165566037736, "p50": 1300.0, "p75": 1600.0, "p90": 2778.2, "monthly_avg": 4904.836621621622}, "food": {"current": 380.0, "unit_avg": 712.8010069549441, "p50": 663.0, "p75": 915.0, "p90": 1194.0, "monthly_avg": 2880.9160583941607}, "top_noded_cat": "Sin comprobante CFDI", "top_noded_val": 335521.36, "top_noded_pct": 85.1171280452773}}; 
let charts={},map=null,geojsonLayer=null,currentGeoJSON=null,currentYear='all',selectedState=null,selectedUser=null;
const stateCoords = {"Aguascalientes":[21.88,-102.28],"Baja California":[30.84,-115.28],"Ciudad de M√©xico":[19.43,-99.13],"Jalisco":[20.67,-103.35],"Nuevo Le√≥n":[25.59,-99.99],"Puebla":[19.04,-98.21],"Quintana Roo":[19.18,-88.48],"Veracruz":[19.54,-96.91],"Yucat√°n":[20.71,-89.09]};

function initDashboard(){ initLeafletMap(); filterData('all'); renderRecommendations(); }

function showTab(id,btn){
    document.querySelectorAll('.tab-content').forEach(el=>el.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(el=>el.classList.remove('active'));
    document.getElementById(id).classList.add('active'); btn.classList.add('active');
    setTimeout(()=>{
        if(id==='mapa'&&map) map.invalidateSize();
        if(id==='comparativa') renderComparison();
        Object.values(charts).forEach(c=>c.resize());
    },50);
}

function filterData(year,btn){
    if(btn){document.querySelectorAll('.btn-filter').forEach(b=>b.classList.remove('active'));btn.classList.add('active');}
    currentYear=year; const d=stsData[year];
    animateValue("kpi-total",d.total,"$"); document.getElementById("kpi-total-sub").innerText=`${d.comprobantes} comp`;
    animateValue("kpi-noded",d.noDeducible,"$"); document.getElementById("kpi-noded-pct").innerText=((d.noDeducible/d.total)*100).toFixed(1)+"%";
    animateValue("kpi-ded",d.deducible,"$");
    let topS="N/A", topV=0; Object.entries(d.states).forEach(([s,v])=>{if(s!=="SinCP"&&v.total>topV){topV=v.total;topS=s;}});
    document.getElementById("kpi-top-state").innerText=topS; document.getElementById("kpi-top-state-val").innerText=fmt(topV);
    
    renderUserCharts(d.users); renderTrend(year); renderCat(year); 
    renderAuditCharts(d.audit); 
    
    updateMap(d.states); updateStateTbl(d.states,d.total); updateUserTbl(d.users); resetGeoFilter();
}

function renderRecommendations(){
    const r=stsData.recommendations; if(!r)return;
    document.getElementById('rec-hotel-list').innerHTML=`<div class="budget-item"><span class="budget-label" style="font-weight:700;color:#fff">Promedio Real (Por Noche):</span><span class="budget-current" style="color:#66fcf1">${fmt(r.hotel.unit_avg)}</span></div><hr style="border-color:rgba(255,255,255,0.1);margin:5px 0"><div class="budget-item"><span>Asignado Actual:</span><span class="budget-current">${fmt(r.hotel.current)}</span></div><div class="budget-item"><span>Conservador:</span><span class="budget-val">${fmt(r.hotel.p50)}</span></div><div class="budget-item"><span>Moderado:</span><span class="budget-val">${fmt(r.hotel.p75)}</span></div><div class="budget-item"><span>Flexible:</span><span class="budget-val">${fmt(r.hotel.p90)}</span></div>`;
    document.getElementById('rec-food-list').innerHTML=`<div class="budget-item"><span class="budget-label" style="font-weight:700;color:#fff">Promedio Real (Por D√≠a):</span><span class="budget-current" style="color:#66fcf1">${fmt(r.food.unit_avg)}</span></div><hr style="border-color:rgba(255,255,255,0.1);margin:5px 0"><div class="budget-item"><span>Asignado Actual:</span><span class="budget-current">${fmt(r.food.current)}</span></div><div class="budget-item"><span>Conservador:</span><span class="budget-val">${fmt(r.food.p50)}</span></div><div class="budget-item"><span>Moderado:</span><span class="budget-val">${fmt(r.food.p75)}</span></div><div class="budget-item"><span>Flexible:</span><span class="budget-val">${fmt(r.food.p90)}</span></div>`;
    document.getElementById('rec-cat-name').innerText=r.top_noded_cat;
    document.getElementById('rec-cat-val').innerHTML=fmt(r.top_noded_val)+` <span style="font-size:0.8rem">(${r.top_noded_pct.toFixed(1)}%)</span>`;
}

function renderAuditCharts(audit) {
    if(!audit) return;
    if(charts.prov) charts.prov.destroy();
    const provs = audit.providers;
    charts.prov = new Chart(document.getElementById('chartProviders'), {
        type: 'bar',
        data: {
            labels: provs.map(p => p.name.length>20?p.name.substr(0,20)+'...':p.name),
            datasets: [{ label: 'Gasto Total', data: provs.map(p => p.total), backgroundColor: '#45a29e', borderRadius: 4, categories: provs.map(p => p.cat) }]
        },
        options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { callbacks: { label: (ctx) => fmt(ctx.raw), afterLabel: (ctx) => `Categor√≠a: ${ctx.dataset.categories[ctx.dataIndex]}` } } } }
    });

    if(charts.week) charts.week.destroy();
    charts.week = new Chart(document.getElementById('chartWeekend'), {
        type: 'pie',
        data: { labels: ['Semana (L-V)', 'Fin de Semana (S-D)'], datasets: [{ data: [audit.weekend.weekday, audit.weekend.weekend], backgroundColor: ['#2ecc71', '#e94560'], borderWidth: 0 }] },
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
    });

    if(charts.pay) charts.pay.destroy();
    const payData = Object.entries(audit.payment).map(([k,v]) => ({name: k, total: v['Pago Total'], noded: v['No Deducible']}));
    charts.pay = new Chart(document.getElementById('chartPayment'), {
        type: 'bar', plugins: [ChartDataLabels],
        data: {
            labels: payData.map(d => d.name),
            datasets: [ { label: 'Deducible', data: payData.map(d => d.total - d.noded), backgroundColor: '#2ecc71' }, { label: 'No Deducible', data: payData.map(d => d.noded), backgroundColor: '#e94560' } ]
        },
        options: { responsive: true, maintainAspectRatio: false, scales: { x: { stacked: true }, y: { stacked: true } }, plugins: { datalabels: { color: '#fff', font: { weight: 'bold', size: 10 }, formatter: function(value, context) { const total = payData[context.dataIndex].total; if (total === 0) return ''; const pct = (value / total * 100); return pct > 5 ? pct.toFixed(0) + '%' : ''; } }, legend: { position: 'top' } } }
    });
}

function selectState(st){
    selectedState=st; document.getElementById('selected-state-name').innerText=st;
    document.querySelectorAll('#state-table-body tr').forEach(r=>{r.classList.toggle('selected',r.cells[0].innerText===st)});
    const sData=stsData[currentYear].states[st];
    const tb=document.getElementById('state-categories-body'); tb.innerHTML='';
    if(sData && sData.types) Object.entries(sData.types).sort((a,b)=>b[1]-a[1]).forEach(([c,v])=>{
        tb.innerHTML+=`<tr><td>${c}</td><td class="amount-cell">${fmt(v)}</td><td class="text-right" style="color:#aaa">${(v/sData.total*100).toFixed(1)}%</td></tr>`;
    });
}
function resetGeoFilter(){
    selectedState=null; document.getElementById('selected-state-name').innerText="Nacional";
    document.querySelectorAll('#state-table-body tr').forEach(r=>r.classList.remove('selected'));
    const tb=document.getElementById('state-categories-body'); tb.innerHTML='';
    const cats=stsData[currentYear].categories; const tot=stsData[currentYear].total;
    Object.entries(cats).sort((a,b)=>b[1]-a[1]).forEach(([c,v])=>{
        tb.innerHTML+=`<tr><td>${c}</td><td class="amount-cell">${fmt(v)}</td><td class="text-right" style="color:#aaa">${(v/tot*100).toFixed(1)}%</td></tr>`;
    });
}

// --- USER INTERACTION (NEW) ---
function updateUserTbl(users){
    const b=document.getElementById('user-table-body'); b.innerHTML='';
    const sorted = Object.entries(users).sort((a,b)=>b[1].total-a[1].total);
    sorted.forEach(([u,v])=>{
        const tr = document.createElement('tr'); 
        tr.onclick = () => selectUser(u);
        tr.style.cursor = 'pointer';
        const pct = v.total > 0 ? ((v.noDeducible / v.total) * 100).toFixed(1) : "0.0";
        tr.innerHTML=`<td>${u}</td><td class="amount-cell">${fmt(v.total)}</td><td class="amount-cell text-danger">${fmt(v.noDeducible)}</td><td class="text-right" style="color:#aaa">${pct}%</td>`;
        b.appendChild(tr);
    });
    // Select first one by default
    if(sorted.length > 0) selectUser(sorted[0][0]);
}

function selectUser(user){
    selectedUser=user; document.getElementById('selected-user-name').innerText=user;
    document.querySelectorAll('#user-table-body tr').forEach(r=>{r.classList.toggle('selected',r.cells[0].innerText===user)});
    renderUserCategoryChart(user);
}

function renderUserCategoryChart(user){
    if(charts.uDetail) charts.uDetail.destroy();
    const uData = stsData[currentYear].users[user];
    if(!uData || !uData.categories) return;
    
    // Sort categories
    const cats = Object.entries(uData.categories).sort((a,b)=>b[1]-a[1]).slice(0,8);
    
    charts.uDetail = new Chart(document.getElementById('userCategoryChart'), {
        type: 'bar',
        data: {
            labels: cats.map(c => c[0]),
            datasets: [{
                label: 'Gasto',
                data: cats.map(c => c[1]),
                backgroundColor: '#66fcf1',
                borderRadius: 4
            }]
        },
        options: {
            indexAxis: 'y',
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: { x: { grid: { color: '#2d3e50' } }, y: { grid: { display: false } } }
        }
    });
}

function initLeafletMap(){
    map=L.map('map',{center:[23.63,-102.55],zoom:5,scrollWheelZoom:false});
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',{attribution:'¬© CARTO'}).addTo(map);
    fetch('https://raw.githubusercontent.com/angelnmara/geojson/master/mexicoHigh.json').then(r=>r.json()).then(d=>{currentGeoJSON=d;updateMap(stsData['all'].states);}).catch(e=>console.log(e));
}
function updateMap(sData){
    if(!map||!currentGeoJSON)return; if(geojsonLayer)map.removeLayer(geojsonLayer);
    const maxV=Math.max(...Object.values(sData).map(v=>v.total).filter(n=>typeof n==='number'));
    geojsonLayer=L.geoJson(currentGeoJSON,{
        style:f=>{
            const val=getVal(f.properties.name,sData);
            return {fillColor:val>0?(val/maxV>0.5?'#e94560':val/maxV>0.2?'#ff9f43':'#45a29e'):'#2c3e50',weight:1,opacity:1,color:'#1f2833',fillOpacity:0.7};
        },
        onEachFeature:(f,l)=>{
            const val=getVal(f.properties.name,sData); const n=f.properties.name;
            if(val>0){l.bindPopup(`<div style="text-align:center;color:#333"><strong>${n}</strong><br>${fmt(val)}</div>`);l.on('click',()=>selectState(getKey(n,sData)));}
        }
    }).addTo(map);
}
function getVal(name,data){ const k=getKey(name,data); return k?data[k].total:0; }
function getKey(geo,data){
    if(data[geo])return geo; if(geo==="Distrito Federal")return "Ciudad de M√©xico";
    for(let k in data){if(geo.includes(k)||k.includes(geo))return k;} return null;
}

function renderComparison(){
    try{
        const d24=stsData['2024'], d25=stsData['2025']; if(!d24||!d25)return;
        const diffT=d24.total>0?((d25.total-d24.total)/d24.total)*100:0;
        const diffN=d24.noDeducible>0?((d25.noDeducible-d24.noDeducible)/d24.noDeducible)*100:0;
        document.getElementById('comparison-container').innerHTML=`<div class="comparison-cards"><div class="year-card"><div class="year-title" style="color:#c5c6c7">2024</div><div style="font-size:0.8rem;color:#45a29e;text-transform:uppercase;margin-bottom:0.5rem">Gasto Total</div><div class="metric-value">${fmt(d24.total)}</div><div style="font-size:0.8rem;color:#45a29e;text-transform:uppercase;margin-bottom:0.5rem">No Deducible</div><div class="metric-value danger">${fmt(d24.noDeducible)}</div></div><div class="year-card highlight"><div class="year-title" style="color:#c5c6c7">2025</div><div style="font-size:0.8rem;color:#45a29e;text-transform:uppercase;margin-bottom:0.5rem">Gasto Total</div><div class="metric-value" style="color:#66fcf1">${fmt(d25.total)} <span class="diff-badge ${diffT>0?'up':'down'}">${diffT>0?'‚Üë':'‚Üì'} ${Math.abs(diffT).toFixed(1)}%</span></div><div style="font-size:0.8rem;color:#45a29e;text-transform:uppercase;margin-bottom:0.5rem">No Deducible</div><div class="metric-value danger">${fmt(d25.noDeducible)} <span class="diff-badge ${diffN>0?'up':'down'}">${diffN>0?'‚Üë':'‚Üì'} ${Math.abs(diffN).toFixed(1)}%</span></div></div></div>`;
        
        if(charts.cBar)charts.cBar.destroy();
        charts.cBar=new Chart(document.getElementById('compBarChart'),{type:'bar',data:{labels:['2024','2025'],datasets:[{label:'Total',data:[d24.total,d25.total],backgroundColor:'#45a29e'},{label:'No Ded.',data:[d24.noDeducible,d25.noDeducible],backgroundColor:'#e94560'}]},options:{responsive:true,maintainAspectRatio:false}});
        
        const mLbls=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"];
        const m24=mLbls.map((_,i)=>stsData['2024'].months[String(i+1)]?.total||0);
        const m25=mLbls.map((_,i)=>stsData['2025'].months[String(i+1)]?.total||0);
        if(charts.cLine)charts.cLine.destroy();
        charts.cLine=new Chart(document.getElementById('compLineChart'),{type:'line',data:{labels:mLbls,datasets:[{label:'2024',data:m24,borderColor:'#45a29e'},{label:'2025',data:m25,borderColor:'#ff9f43'}]},options:{responsive:true,maintainAspectRatio:false}});
    }catch(e){}
}

function updateStateTbl(st,tot){
    const b=document.getElementById('state-table-body'); b.innerHTML='';
    Object.entries(st).sort((a,b)=>b[1].total-a[1].total).forEach(([s,v])=>{if(v.total>0){
        const tr=document.createElement('tr'); tr.onclick=()=>selectState(s);
        tr.innerHTML=`<td>${s==='SinCP'?'üåé Sin Estado':s}</td><td class="amount-cell">${fmt(v.total)}</td>`; b.appendChild(tr);
    }});
}

function renderUserCharts(us){
    const uArr=Object.entries(us).map(([k,v])=>({name:k,t:v.total,n:v.noDeducible})).sort((a,b)=>b.t-a.t);
    const topT={l:uArr.slice(0,10).map(x=>x.name),d:uArr.slice(0,10).map(x=>x.t)};
    if(charts.uT)charts.uT.destroy();
    charts.uT=new Chart(document.getElementById('userChart'),{type:'doughnut',data:{labels:topT.l,datasets:[{data:topT.d,backgroundColor:['#45a29e','#66fcf1','#e94560','#ff9f43','#2ecc71'],borderWidth:0}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'right'}}}});
    
    const uArrN=uArr.sort((a,b)=>b.n-a.n);
    const topN={l:uArrN.slice(0,10).map(x=>x.name),d:uArrN.slice(0,10).map(x=>x.n)};
    if(charts.uN)charts.uN.destroy();
    charts.uN=new Chart(document.getElementById('userChartNoDed'),{type:'bar',data:{labels:topN.l,datasets:[{label:'No Deducible',data:topN.d,backgroundColor:'#e94560'}]},options:{indexAxis:'y',responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}}}});
}
function renderTrend(y){
    if(charts.tr)charts.tr.destroy();
    const md=stsData[y].months; 
    let lbls=[],dt=[],dn=[];
    if(y==='all'){lbls=Object.keys(md).sort(); dt=lbls.map(k=>md[k].total); dn=lbls.map(k=>md[k].noDeducible);}
    else{lbls=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"]; dt=Object.values(md).map(v=>v.total); dn=Object.values(md).map(v=>v.noDeducible);}
    charts.tr=new Chart(document.getElementById('trendChart'),{type:'line',data:{labels:lbls,datasets:[{label:'Gasto',data:dt,borderColor:'#66fcf1'},{label:'No Ded',data:dn,borderColor:'#e94560'}]},options:{responsive:true,maintainAspectRatio:false}});
}
function renderCat(y){
    const c=stsData[y].categories; const s=Object.entries(c).sort((a,b)=>b[1]-a[1]).slice(0,5);
    if(charts.cat)charts.cat.destroy();
    charts.cat=new Chart(document.getElementById('categoryChart'),{type:'bar',data:{labels:s.map(x=>x[0]),datasets:[{label:'Monto',data:s.map(x=>x[1]),backgroundColor:'#45a29e'}]},options:{indexAxis:'y',responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}}}});
}

Chart.defaults.color='#94a3b8'; Chart.defaults.borderColor='#334155';
function fmt(n){return new Intl.NumberFormat('es-MX',{style:'currency',currency:'MXN',maximumFractionDigits:0}).format(n);}
function animateValue(id,end,p){document.getElementById(id).innerHTML=p+fmt(end).replace('$','');}
initDashboard();
</script>
</body>
</html>
